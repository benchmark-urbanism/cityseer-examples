[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Cityseer Examples",
    "section": "",
    "text": "This repository contains examples for the cityseer-api package.\nUse the navigation menu to explore examples.",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "index.html#getting-started",
    "href": "index.html#getting-started",
    "title": "Cityseer Examples",
    "section": "Getting Started",
    "text": "Getting Started\ncityseer is a python package that can be installed with pip:\n\n# !pip install --upgrade cityseer\n\n\n\n\n\n\n\nWarning\n\n\n\nThe guide and examples are based on cityseer&gt;=4.12.0. Version 4.12.0 uses a new output column naming convention for computed metrics for improved consistency. If using an earlier version, please upgrade to 4.12.0 or else adapt the column names to match the earlier convention.\n\n\ncityseer revolves around networks (graphs). If you’re comfortable with numpy and abstract data handling, then the underlying data structures can be created and manipulated directly. However, it is generally more convenient to sketch the graph using NetworkX and to let cityseer take care of initialising and converting the graph for you.\n\n# any networkX MultiGraph with 'x' and 'y' node attributes will do\n# here we'll use the cityseer mock module to generate an example networkX graph\nimport networkx as nx\nfrom cityseer.tools import mock, graphs, plot, io\n\nG = mock.mock_graph()\nprint(G)\n# let's plot the network\nplot.plot_nx(G, labels=True, node_size=80, dpi=200, figsize=(4, 4))\n\nINFO:cityseer.tools.plot:Preparing graph nodes\nINFO:cityseer.tools.plot:Preparing graph edges\n\n\nMultiGraph with 57 nodes and 79 edges\n\n\n  0%|          | 0/79 [00:00&lt;?, ?it/s]100%|██████████| 79/79 [00:00&lt;00:00, 424807.71it/s]",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "index.html#graph-preparation",
    "href": "index.html#graph-preparation",
    "title": "Cityseer Examples",
    "section": "Graph Preparation",
    "text": "Graph Preparation\nThe tools.graphs module contains a collection of convenience functions for the preparation and conversion of networkX MultiGraphs, i.e. undirected graphs allowing for parallel edges. The tools.graphs module is designed to work with raw shapely Linestring geometries that have been assigned to the graph’s edge (link) geom attributes. The benefit to this approach is that the geometry of the network is decoupled from the topology: the topology is consequently free from distortions which would otherwise confound centrality and other metrics.\nThere are generally two scenarios when creating a street network graph:\n\nIn the ideal case, if you have access to a high-quality street network dataset – which keeps the topology of the network separate from the geometry of the streets – then you would construct the network based on the topology while assigning the roadway geometries to the respective edges spanning the nodes. OS Open Roads is a good example of this type of dataset. Assigning the geometries to an edge involves A) casting the geometry to a shapely LineString, and B) assigning this geometry to the respective edge by adding the LineString geometry as a geom attribute. e.g. G.add_edge(start_node, end_node, geom=a_linestring_geom).\nIn reality, most data-sources are not this refined and will represent roadway geometries by adding additional nodes to the network. For a variety of reasons, this is not ideal and you may want to follow the Graph Cleaning or Graph Corrections guides.\n\nHere, we’ll walk through a high-level overview showing how to use cityseer. You can provide your own shapely geometries if available; else, you can auto-infer simple geometries from the start to end node of each network edge, which works well for graphs where nodes have been used to inscribe roadway geometries (i.e. OSM).\n\n# use nx_simple_geoms to infer geoms for your edges\nG = graphs.nx_simple_geoms(G)\nplot.plot_nx(G, labels=True, node_size=80, plot_geoms=True, dpi=200, figsize=(4, 4))\n\nINFO:cityseer.tools.graphs:Generating interpolated edge geometries.\n  0%|          | 0/79 [00:00&lt;?, ?it/s]100%|██████████| 79/79 [00:00&lt;00:00, 32725.93it/s]\nINFO:cityseer.tools.plot:Preparing graph nodes\nINFO:cityseer.tools.plot:Preparing graph edges\n  0%|          | 0/79 [00:00&lt;?, ?it/s]100%|██████████| 79/79 [00:00&lt;00:00, 27628.62it/s]\n\n\n\n\n\n\n\n\n\nWe have now inferred geometries for each edge, meaning that each edge now has an associated LineString geometry. Any further manipulation of the graph using the cityseer.graph module will retain and further manipulate these geometries in-place.\nOnce the geoms are readied, we can use tools such as nx_decompose for generating granular graph representations and nx_to_dual for casting a primal graph representation to its dual.\n\n# this will (optionally) decompose the graph\nG_decomp = graphs.nx_decompose(G, 50)\nplot.plot_nx(G_decomp, plot_geoms=True, labels=False, dpi=200, figsize=(4, 4))\n\nINFO:cityseer.tools.graphs:Decomposing graph to maximum edge lengths of 50.\n  0%|          | 0/79 [00:00&lt;?, ?it/s]100%|██████████| 79/79 [00:00&lt;00:00, 1940.00it/s]\nINFO:cityseer.tools.plot:Preparing graph nodes\nINFO:cityseer.tools.plot:Preparing graph edges\n  0%|          | 0/316 [00:00&lt;?, ?it/s]100%|██████████| 316/316 [00:00&lt;00:00, 49359.45it/s]\n\n\n\n\n\n\n\n\n\n\n# this will (optionally) cast to a dual network\nG_dual = graphs.nx_to_dual(G)\n# here we are plotting the newly decomposed graph (blue) against the original graph (red)\nplot.plot_nx_primal_or_dual(G, G_dual, plot_geoms=False, dpi=200, figsize=(4, 4))\n\nINFO:cityseer.tools.graphs:Converting graph to dual.\nINFO:cityseer.tools.graphs:Preparing dual nodes\n  0%|          | 0/79 [00:00&lt;?, ?it/s]100%|██████████| 79/79 [00:00&lt;00:00, 15893.61it/s]\nINFO:cityseer.tools.graphs:Preparing dual edges (splitting and welding geoms)\n  0%|          | 0/79 [00:00&lt;?, ?it/s]100%|██████████| 79/79 [00:00&lt;00:00, 889.91it/s]\nINFO:cityseer.tools.plot:Preparing graph nodes\nINFO:cityseer.tools.plot:Preparing graph edges\n  0%|          | 0/79 [00:00&lt;?, ?it/s]100%|██████████| 79/79 [00:00&lt;00:00, 461490.27it/s]\nINFO:cityseer.tools.plot:Preparing graph nodes\nINFO:cityseer.tools.plot:Preparing graph edges\n  0%|          | 0/155 [00:00&lt;?, ?it/s]100%|██████████| 155/155 [00:00&lt;00:00, 513115.33it/s]",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "index.html#metrics",
    "href": "index.html#metrics",
    "title": "Cityseer Examples",
    "section": "Metrics",
    "text": "Metrics\nAfter graph preparation and cleaning has been completed, the networkX graph can be transformed into data structures for efficiently computing centralities, land-use measures, or statistical aggregations.\nUse network_structure_from_nx to convert a networkX graph into a GeoPandas GeoDataFrame and a rustalgos.NetworkStructure, which is used by Cityseer for efficiently computing over the network.\n\nNetwork Centralities\nThe networks.node_centrality_shortest, networks.node_centrality_simplest, and networks.segment_centrality methods wrap underlying rust functions that compute the centrality methods. All selected measures and distance thresholds are computed simultaneously to reduce the amount of time required for multi-variable and multi-scalar workflows. The results of the computations will be written to the GeoDataFrame.\n\nfrom cityseer.metrics import networks\n\n# create a Network layer from the networkX graph\n# use a CRS EPSG code matching the projected coordinate reference system for your data\nnodes_gdf, edges_gdf, network_structure = io.network_structure_from_nx(\n    G_decomp, crs=3395\n)\n# the underlying method allows the computation of various centralities simultaneously, e.g.\nnodes_gdf = networks.segment_centrality(\n    network_structure=network_structure,  # the network structure for which to compute the measures\n    nodes_gdf=nodes_gdf,  # the nodes GeoDataFrame, to which the results will be written\n    distances=[\n        200,\n        400,\n        800,\n        1600,\n    ],  # the distance thresholds for which to compute centralities\n)\nnodes_gdf.head()  # the results are now in the GeoDataFrame\n\nINFO:cityseer.tools.io:Preparing node and edge arrays from networkX graph.\n  0%|          | 0/294 [00:00&lt;?, ?it/s]100%|██████████| 294/294 [00:00&lt;00:00, 110475.31it/s]\n  0%|          | 0/294 [00:00&lt;?, ?it/s]100%|██████████| 294/294 [00:00&lt;00:00, 9539.88it/s]\nINFO:cityseer.metrics.networks:Computing shortest path segment centrality.\n  0%|          | 0/294 [00:00&lt;?, ?it/s]100%|██████████| 294/294 [00:01&lt;00:00, 293.84it/s]100%|██████████| 294/294 [00:01&lt;00:00, 293.60it/s]\n\n\n\n\n\n\n\n\n\nns_node_idx\nx\ny\nlive\nweight\ngeom\ncc_seg_density_200\ncc_seg_density_400\ncc_seg_density_800\ncc_seg_density_1600\n...\ncc_seg_harmonic_800\ncc_seg_harmonic_1600\ncc_seg_beta_200\ncc_seg_beta_400\ncc_seg_beta_800\ncc_seg_beta_1600\ncc_seg_betweenness_200\ncc_seg_betweenness_400\ncc_seg_betweenness_800\ncc_seg_betweenness_1600\n\n\n\n\n0\n0\n700700.0\n5719700.0\nTrue\n1\nPOINT (700700 5719700)\n857.327026\n3042.260254\n10088.987305\n13137.789062\n...\n36.822689\n40.173214\n159.837616\n421.984436\n1365.011597\n3582.891113\n590.865967\n2805.016113\n23574.986328\n159337.343750\n\n\n1\n1\n700610.0\n5719780.0\nTrue\n1\nPOINT (700610 5719780)\n784.184753\n2527.174805\n9059.986328\n13137.791992\n...\n34.135193\n38.450062\n154.743927\n388.553589\n1221.976562\n3301.651611\n534.708435\n2270.786133\n15957.037109\n103352.734375\n\n\n2\n2\n700460.0\n5719700.0\nTrue\n1\nPOINT (700460 5719700)\n695.835876\n2062.288330\n6928.821289\n13137.790039\n...\n29.375729\n35.568359\n150.506683\n353.928864\n999.668030\n2788.973877\n484.306824\n1700.836914\n7541.829590\n36259.562500\n\n\n3\n3\n700520.0\n5719820.0\nTrue\n1\nPOINT (700520 5719820)\n817.972900\n2366.633057\n5945.978027\n13137.791992\n...\n28.526949\n35.446590\n156.397873\n392.560852\n1018.365723\n2680.288574\n538.021851\n2131.172119\n7549.370117\n24907.962891\n\n\n4\n4\n700620.0\n5719905.0\nTrue\n1\nPOINT (700620 5719905)\n812.112549\n2419.865234\n7675.241699\n13137.791992\n...\n31.385777\n36.887234\n155.821732\n388.663147\n1108.671631\n2981.365723\n528.050293\n2153.490723\n11441.312500\n66363.117188\n\n\n\n\n5 rows × 22 columns\n\n\n\n\n# plot centrality\nfrom matplotlib import colors\n\n# custom colourmap\ncmap = colors.LinearSegmentedColormap.from_list(\"cityseer\", [\"#64c1ff\", \"#d32f2f\"])\n# normalise the values\nsegment_harmonic_vals = nodes_gdf[\"cc_seg_harmonic_800\"]\nsegment_harmonic_vals = colors.Normalize()(segment_harmonic_vals)\n# cast against the colour map\nsegment_harmonic_cols = cmap(segment_harmonic_vals)\n# plot segment_harmonic\n# cityseer's plot methods are used here and in tests for convenience\n# that said, rather use plotting methods directly from networkX or GeoPandas where possible\nplot.plot_nx(\n    G_decomp, labels=False, node_colour=segment_harmonic_cols, dpi=200, figsize=(4, 4)\n)\n\nINFO:cityseer.tools.plot:Preparing graph nodes\nINFO:cityseer.tools.plot:Preparing graph edges\n  0%|          | 0/316 [00:00&lt;?, ?it/s]100%|██████████| 316/316 [00:00&lt;00:00, 251499.06it/s]\n\n\n\n\n\n\n\n\n\n\n\nLand-use and statistical measures\nLanduse and statistical measures require a GeoPandas GeoDataFrame consisting of Point geometries. Columns representing categorical landuse information (“pub”, “shop”, “school”) can be passed to landuse methods, whereas columns representing numerical information can be used for statistical methods.\nWhen computing these measures, cityseer will assign each data point to the two closest network nodes — one in either direction — based on the closest adjacent street edge. This enables cityseer to use dynamic spatial aggregation methods that more accurately describe distances from the perspective of pedestrians travelling over the network, and relative to the direction of approach.\nlayers.compute_landuses and layers.compute_mixed_uses methods are used for the calculation of land-use accessibility and mixed-use measures whereas layers.compute_stats can be used for statistical aggregations. As with the centrality methods, the measures are computed over the network and are computed simultaneously for all measures and distances.\n\nfrom cityseer.metrics import layers\n\n# a mock data dictionary representing categorical landuse data\n# here randomly generated letters represent fictitious landuse categories\ndata_gdf = mock.mock_landuse_categorical_data(G_decomp, random_seed=25)\ndata_gdf.head()\n\n\n\n\n\n\n\n\ngeometry\ndata_id\ncategorical_landuses\n\n\nuid\n\n\n\n\n\n\n\n0\nPOINT (701144.149 5719228.311)\n0\nh\n\n\n1\nPOINT (700798.732 5719938.464)\n1\nf\n\n\n2\nPOINT (700434.607 5719165.951)\n2\nh\n\n\n3\nPOINT (700323.093 5719450.769)\n3\na\n\n\n4\nPOINT (700593.32 5719841.434)\n4\nh\n\n\n\n\n\n\n\n\n# example easy-wrapper method for computing mixed-uses\n# this is a distance weighted form of hill diversity\nnodes_gdf, data_gdf = layers.compute_mixed_uses(\n    data_gdf,  # the source data\n    landuse_column_label=\"categorical_landuses\",  # column in the dataframe which contains the landuse labels\n    nodes_gdf=nodes_gdf,  # nodes GeoDataFrame - the results are written here\n    network_structure=network_structure,  # measures will be computed relative to pedestrian distances over the network\n    distances=[\n        200,\n        400,\n        800,\n        1600,\n    ],  # distance thresholds for which you want to compute the measures\n)\nprint(\n    nodes_gdf.columns\n)  # the GeoDataFrame will contain the results of the calculations\nprint(nodes_gdf[\"cc_hill_q0_800_nw\"])  # which can be retrieved as needed\n\nINFO:cityseer.metrics.layers:Computing mixed-use measures.\n  0%|          | 0/294 [00:00&lt;?, ?it/s]100%|██████████| 294/294 [00:01&lt;00:00, 293.92it/s]100%|██████████| 294/294 [00:01&lt;00:00, 293.63it/s]\n\n\nIndex(['ns_node_idx', 'x', 'y', 'live', 'weight', 'geom', 'cc_seg_density_200',\n       'cc_seg_density_400', 'cc_seg_density_800', 'cc_seg_density_1600',\n       'cc_seg_harmonic_200', 'cc_seg_harmonic_400', 'cc_seg_harmonic_800',\n       'cc_seg_harmonic_1600', 'cc_seg_beta_200', 'cc_seg_beta_400',\n       'cc_seg_beta_800', 'cc_seg_beta_1600', 'cc_seg_betweenness_200',\n       'cc_seg_betweenness_400', 'cc_seg_betweenness_800',\n       'cc_seg_betweenness_1600', 'cc_hill_q0_200_nw', 'cc_hill_q0_200_wt',\n       'cc_hill_q1_200_nw', 'cc_hill_q1_200_wt', 'cc_hill_q2_200_nw',\n       'cc_hill_q2_200_wt', 'cc_hill_q0_400_nw', 'cc_hill_q0_400_wt',\n       'cc_hill_q1_400_nw', 'cc_hill_q1_400_wt', 'cc_hill_q2_400_nw',\n       'cc_hill_q2_400_wt', 'cc_hill_q0_800_nw', 'cc_hill_q0_800_wt',\n       'cc_hill_q1_800_nw', 'cc_hill_q1_800_wt', 'cc_hill_q2_800_nw',\n       'cc_hill_q2_800_wt', 'cc_hill_q0_1600_nw', 'cc_hill_q0_1600_wt',\n       'cc_hill_q1_1600_nw', 'cc_hill_q1_1600_wt', 'cc_hill_q2_1600_nw',\n       'cc_hill_q2_1600_wt'],\n      dtype='object')\n0          9.0\n1          9.0\n2          9.0\n3          9.0\n4          9.0\n          ... \n53±0±54    2.0\n53±1±54    2.0\n53±2±54    2.0\n54±0±55    2.0\n54±1±55    2.0\nName: cc_hill_q0_800_nw, Length: 294, dtype: float32\n\n\n\n\n\n\n# for curiosity's sake - plot the assignments to see which edges the data points were assigned to\nplot.plot_assignment(network_structure, G_decomp, data_gdf, dpi=200, figsize=(4, 4))\n\n/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/cityseer/tools/plot.py:559: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.\n  plt.tight_layout()\n\n\n\n\n\n\n\n\n\n\n# plot distance-weighted hill mixed uses\nmixed_uses_vals = nodes_gdf[\"cc_hill_q0_800_wt\"]\nmixed_uses_vals = colors.Normalize()(mixed_uses_vals)\nmixed_uses_cols = cmap(mixed_uses_vals)\nplot.plot_assignment(\n    network_structure,\n    G_decomp,\n    data_gdf,\n    node_colour=mixed_uses_cols,\n    data_labels=data_gdf[\"categorical_landuses\"].values,\n    dpi=200,\n    figsize=(4, 4),\n)\n\n/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/site-packages/cityseer/tools/plot.py:559: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.\n  plt.tight_layout()\n\n\n\n\n\n\n\n\n\n\n# compute landuse accessibilities for land-use types a, b, c\nnodes_gdf, data_gdf = layers.compute_accessibilities(\n    data_gdf,  # the source data\n    landuse_column_label=\"categorical_landuses\",  # column in the dataframe which contains the landuse labels\n    accessibility_keys=[\n        \"a\",\n        \"b\",\n        \"c\",\n    ],  # the landuse categories for which to compute accessibilities\n    nodes_gdf=nodes_gdf,  # nodes GeoDataFrame - the results are written here\n    network_structure=network_structure,  # measures will be computed relative to pedestrian distances over the network\n    distances=[\n        200,\n        400,\n        800,\n        1600,\n    ],  # distance thresholds for which you want to compute the measures\n)\n# accessibilities are computed in both weighted and unweighted forms, e.g. for \"a\" and \"b\" landuse codes\nprint(\n    nodes_gdf[[\"cc_a_800_wt\", \"cc_b_1600_nw\"]]\n)  # and can be retrieved as needed\n\nINFO:cityseer.metrics.layers:Computing land-use accessibility for: a, b, c\n  0%|          | 0/294 [00:00&lt;?, ?it/s]100%|██████████| 294/294 [00:01&lt;00:00, 293.91it/s]100%|██████████| 294/294 [00:01&lt;00:00, 293.64it/s]\n\n\n         cc_a_800_wt  cc_b_1600_nw\n0           0.316222           2.0\n1           0.173186           2.0\n2           0.074022           2.0\n3           0.047997           2.0\n4           0.092515           2.0\n...              ...           ...\n53±0±54     0.000000           0.0\n53±1±54     0.000000           0.0\n53±2±54     0.000000           0.0\n54±0±55     0.000000           0.0\n54±1±55     0.000000           0.0\n\n[294 rows x 2 columns]\n\n\n\n\n\nAggregations can likewise be computed for numerical data. Let’s generate some mock numerical data:\n\nnumerical_data_gdf = mock.mock_numerical_data(G_decomp, num_arrs=3)\nnumerical_data_gdf.head()\n# compute stats for column mock_numerical_1\nnodes_gdf, numerical_data_gdf = layers.compute_stats(\n    numerical_data_gdf,  # the source data\n    stats_column_label=\"mock_numerical_1\",  # numerical column to compute stats for\n    nodes_gdf=nodes_gdf,  # nodes GeoDataFrame - the results are written here\n    network_structure=network_structure,  # measures will be computed relative to pedestrian distances over the network\n    distances=[\n        800,\n        1600,\n    ],  # distance thresholds for which you want to compute the measures\n)\n# statistical aggregations are calculated for each requested column, and in the following forms:\n# max, min, sum, sum_weighted, mean, mean_weighted, variance, variance_weighted\nprint(nodes_gdf[\"cc_mock_numerical_1_max_800\"])\nprint(nodes_gdf[\"cc_mock_numerical_1_mean_800_wt\"])\n\nINFO:cityseer.metrics.layers:Computing statistics.\n  0%|          | 0/294 [00:00&lt;?, ?it/s]100%|██████████| 294/294 [00:01&lt;00:00, 293.84it/s]100%|██████████| 294/294 [00:01&lt;00:00, 293.59it/s]\n\n\n0          99.438004\n1          99.438004\n2          99.438004\n3          90.749001\n4          99.438004\n             ...    \n53±0±54     1.913000\n53±1±54     1.913000\n53±2±54     1.913000\n54±0±55     1.913000\n54±1±55     1.913000\nName: cc_mock_numerical_1_max_800, Length: 294, dtype: float32\n0          51.426266\n1          53.213055\n2          51.837536\n3          49.952995\n4          53.090725\n             ...    \n53±0±54     1.913000\n53±1±54     1.913000\n53±2±54     1.913000\n54±0±55     1.913000\n54±1±55     1.913000\nName: cc_mock_numerical_1_mean_800_wt, Length: 294, dtype: float32\n\n\n\n\n\nThe landuse metrics and statistical aggregations are computed over the street network relative to the network, with results written to each node. The mixed-use, accessibility, and statistical aggregations can therefore be compared directly to centrality computations from the same locations, and can be correlated or otherwise compared.\nData derived from metrics can be converted back into a NetworkX graph using the nx_from_cityseer_geopandas method.\n\nnx_multigraph_round_trip = io.nx_from_cityseer_geopandas(\n    nodes_gdf,\n    edges_gdf,\n)\nnx_multigraph_round_trip.nodes[\"0\"]\n\nINFO:cityseer.tools.io:Populating node and edge map data to a networkX graph.\nINFO:cityseer.tools.io:Unpacking node data.\n0it [00:00, ?it/s]294it [00:00, 13140.30it/s]\nINFO:cityseer.tools.io:Unpacking edge data.\n0it [00:00, ?it/s]632it [00:00, 14019.76it/s]\nINFO:cityseer.tools.io:Unpacking metrics to nodes.\n0it [00:00, ?it/s]294it [00:00, 21881.77it/s]\n0it [00:00, ?it/s]294it [00:00, 21072.94it/s]\n0it [00:00, ?it/s]294it [00:00, 23672.52it/s]\n0it [00:00, ?it/s]294it [00:00, 23384.76it/s]\n0it [00:00, ?it/s]294it [00:00, 22970.07it/s]\n0it [00:00, ?it/s]294it [00:00, 23693.45it/s]\n0it [00:00, ?it/s]294it [00:00, 22590.51it/s]\n0it [00:00, ?it/s]294it [00:00, 23852.02it/s]\n0it [00:00, ?it/s]294it [00:00, 23196.93it/s]\n0it [00:00, ?it/s]294it [00:00, 23219.20it/s]\n0it [00:00, ?it/s]294it [00:00, 22917.14it/s]\n0it [00:00, ?it/s]294it [00:00, 23430.98it/s]\n0it [00:00, ?it/s]294it [00:00, 22578.51it/s]\n0it [00:00, ?it/s]294it [00:00, 22150.63it/s]\n0it [00:00, ?it/s]294it [00:00, 22895.01it/s]\n0it [00:00, ?it/s]294it [00:00, 23420.74it/s]\n0it [00:00, ?it/s]294it [00:00, 23452.81it/s]\n0it [00:00, ?it/s]294it [00:00, 22311.74it/s]\n0it [00:00, ?it/s]294it [00:00, 23526.19it/s]\n0it [00:00, ?it/s]294it [00:00, 23219.20it/s]\n0it [00:00, ?it/s]294it [00:00, 23273.54it/s]\n0it [00:00, ?it/s]294it [00:00, 22644.85it/s]\n0it [00:00, ?it/s]294it [00:00, 23240.64it/s]\n0it [00:00, ?it/s]294it [00:00, 22866.14it/s]\n0it [00:00, ?it/s]294it [00:00, 21293.82it/s]\n0it [00:00, ?it/s]294it [00:00, 22414.35it/s]\n0it [00:00, ?it/s]294it [00:00, 21598.16it/s]\n0it [00:00, ?it/s]294it [00:00, 23395.41it/s]\n0it [00:00, ?it/s]294it [00:00, 23752.78it/s]\n0it [00:00, ?it/s]294it [00:00, 23532.93it/s]\n0it [00:00, ?it/s]294it [00:00, 22980.77it/s]\n0it [00:00, ?it/s]294it [00:00, 22583.89it/s]\n0it [00:00, ?it/s]294it [00:00, 23090.51it/s]\n0it [00:00, ?it/s]294it [00:00, 23284.09it/s]\n0it [00:00, ?it/s]294it [00:00, 23255.55it/s]\n0it [00:00, ?it/s]294it [00:00, 22390.34it/s]\n0it [00:00, ?it/s]294it [00:00, 22215.27it/s]\n0it [00:00, ?it/s]294it [00:00, 23280.57it/s]\n0it [00:00, ?it/s]294it [00:00, 22717.02it/s]\n0it [00:00, ?it/s]294it [00:00, 22920.12it/s]\n0it [00:00, ?it/s]294it [00:00, 22442.90it/s]\n0it [00:00, ?it/s]294it [00:00, 23077.54it/s]\n0it [00:00, ?it/s]294it [00:00, 22925.66it/s]\n0it [00:00, ?it/s]294it [00:00, 21605.35it/s]\n0it [00:00, ?it/s]294it [00:00, 23182.97it/s]\n0it [00:00, ?it/s]294it [00:00, 22649.01it/s]\n0it [00:00, ?it/s]294it [00:00, 22741.32it/s]\n0it [00:00, ?it/s]294it [00:00, 23487.66it/s]\n0it [00:00, ?it/s]294it [00:00, 23167.29it/s]\n0it [00:00, ?it/s]294it [00:00, 23143.81it/s]\n0it [00:00, ?it/s]294it [00:00, 23440.77it/s]\n0it [00:00, ?it/s]294it [00:00, 22977.35it/s]\n0it [00:00, ?it/s]294it [00:00, 23435.87it/s]\n0it [00:00, ?it/s]294it [00:00, 23562.15it/s]\n0it [00:00, ?it/s]294it [00:00, 23859.40it/s]\n0it [00:00, ?it/s]294it [00:00, 23253.79it/s]\n0it [00:00, ?it/s]294it [00:00, 23448.35it/s]\n0it [00:00, ?it/s]294it [00:00, 23886.21it/s]\n0it [00:00, ?it/s]294it [00:00, 23213.08it/s]\n0it [00:00, ?it/s]294it [00:00, 21564.92it/s]\n0it [00:00, ?it/s]294it [00:00, 21885.66it/s]\n0it [00:00, ?it/s]294it [00:00, 23124.71it/s]\n0it [00:00, ?it/s]294it [00:00, 17616.58it/s]\n0it [00:00, ?it/s]294it [00:00, 13800.30it/s]\n0it [00:00, ?it/s]294it [00:00, 14998.61it/s]\n0it [00:00, ?it/s]294it [00:00, 16758.52it/s]\n0it [00:00, ?it/s]294it [00:00, 14684.26it/s]\n0it [00:00, ?it/s]294it [00:00, 18336.44it/s]\n0it [00:00, ?it/s]294it [00:00, 20589.49it/s]\n0it [00:00, ?it/s]294it [00:00, 21416.61it/s]\n0it [00:00, ?it/s]294it [00:00, 22254.16it/s]\n0it [00:00, ?it/s]294it [00:00, 22072.91it/s]\n0it [00:00, ?it/s]294it [00:00, 20610.14it/s]\n0it [00:00, ?it/s]294it [00:00, 23480.95it/s]\n0it [00:00, ?it/s]294it [00:00, 23694.36it/s]\n0it [00:00, ?it/s]294it [00:00, 20355.66it/s]\n0it [00:00, ?it/s]294it [00:00, 22153.01it/s]\n0it [00:00, ?it/s]294it [00:00, 24009.92it/s]\n0it [00:00, ?it/s]294it [00:00, 23177.74it/s]\n0it [00:00, ?it/s]294it [00:00, 13918.36it/s]\n0it [00:00, ?it/s]294it [00:00, 16891.90it/s]\n0it [00:00, ?it/s]294it [00:00, 21525.77it/s]\n0it [00:00, ?it/s]294it [00:00, 23348.90it/s]\n0it [00:00, ?it/s]294it [00:00, 22245.73it/s]\n0it [00:00, ?it/s]294it [00:00, 22077.66it/s]\n0it [00:00, ?it/s]294it [00:00, 21617.09it/s]\n0it [00:00, ?it/s]294it [00:00, 22026.00it/s]\n\n\n{'x': 700700.0,\n 'y': 5719700.0,\n 'live': True,\n 'weight': 1,\n 'cc_seg_density_200': 857.3270263671875,\n 'cc_seg_density_400': 3042.26025390625,\n 'cc_seg_density_800': 10088.9873046875,\n 'cc_seg_density_1600': 13137.7890625,\n 'cc_seg_harmonic_200': 17.577617645263672,\n 'cc_seg_harmonic_400': 24.706350326538086,\n 'cc_seg_harmonic_800': 36.822689056396484,\n 'cc_seg_harmonic_1600': 40.173213958740234,\n 'cc_seg_beta_200': 159.83761596679688,\n 'cc_seg_beta_400': 421.98443603515625,\n 'cc_seg_beta_800': 1365.0115966796875,\n 'cc_seg_beta_1600': 3582.89111328125,\n 'cc_seg_betweenness_200': 590.865966796875,\n 'cc_seg_betweenness_400': 2805.01611328125,\n 'cc_seg_betweenness_800': 23574.986328125,\n 'cc_seg_betweenness_1600': 159337.34375,\n 'cc_hill_q0_200_nw': 4.0,\n 'cc_hill_q0_200_wt': 0.214272141456604,\n 'cc_hill_q1_200_nw': 3.789292097091675,\n 'cc_hill_q1_200_wt': 0.20572809875011444,\n 'cc_hill_q2_200_nw': 3.571428060531616,\n 'cc_hill_q2_200_wt': 0.19956739246845245,\n 'cc_hill_q0_400_nw': 9.0,\n 'cc_hill_q0_400_wt': 1.1907039880752563,\n 'cc_hill_q1_400_nw': 8.171717643737793,\n 'cc_hill_q1_400_wt': 1.0840710401535034,\n 'cc_hill_q2_400_nw': 7.529411792755127,\n 'cc_hill_q2_400_wt': 1.0111380815505981,\n 'cc_hill_q0_800_nw': 9.0,\n 'cc_hill_q0_800_wt': 3.055056571960449,\n 'cc_hill_q1_800_nw': 8.06127643585205,\n 'cc_hill_q1_800_wt': 2.7106285095214844,\n 'cc_hill_q2_800_nw': 7.449613094329834,\n 'cc_hill_q2_800_wt': 2.509385108947754,\n 'cc_hill_q0_1600_nw': 10.0,\n 'cc_hill_q0_1600_wt': 5.220043659210205,\n 'cc_hill_q1_1600_nw': 9.22851276397705,\n 'cc_hill_q1_1600_wt': 4.775951862335205,\n 'cc_hill_q2_1600_nw': 8.672131538391113,\n 'cc_hill_q2_1600_wt': 4.467940807342529,\n 'cc_a_200_nw': 0.0,\n 'cc_a_200_wt': 0.0,\n 'cc_a_400_nw': 2.0,\n 'cc_a_400_wt': 0.050510115921497345,\n 'cc_a_800_nw': 2.0,\n 'cc_a_800_wt': 0.3162217140197754,\n 'cc_a_1600_nw': 5.0,\n 'cc_a_1600_wt': 1.0843467712402344,\n 'cc_a_nearest_max_1600': 349.61199951171875,\n 'cc_b_200_nw': 1.0,\n 'cc_b_200_wt': 0.01839187555015087,\n 'cc_b_400_nw': 1.0,\n 'cc_b_400_wt': 0.13561664521694183,\n 'cc_b_800_nw': 2.0,\n 'cc_b_800_wt': 0.46969375014305115,\n 'cc_b_1600_nw': 2.0,\n 'cc_b_1600_wt': 0.9253296852111816,\n 'cc_b_nearest_max_1600': 199.7923126220703,\n 'cc_c_200_nw': 0.0,\n 'cc_c_200_wt': 0.0,\n 'cc_c_400_nw': 1.0,\n 'cc_c_400_wt': 0.1017569750547409,\n 'cc_c_800_nw': 4.0,\n 'cc_c_800_wt': 0.39100760221481323,\n 'cc_c_1600_nw': 5.0,\n 'cc_c_1600_wt': 1.1247146129608154,\n 'cc_c_nearest_max_1600': 228.5167999267578,\n 'cc_mock_numerical_1_sum_800_nw': 1170.7388916015625,\n 'cc_mock_numerical_1_sum_800_wt': 211.98062133789062,\n 'cc_mock_numerical_1_mean_800_nw': 41.812103271484375,\n 'cc_mock_numerical_1_mean_800_wt': 51.426265716552734,\n 'cc_mock_numerical_1_count_800_nw': 28.0,\n 'cc_mock_numerical_1_count_800_wt': 4.122030258178711,\n 'cc_mock_numerical_1_var_800_nw': 766.1060791015625,\n 'cc_mock_numerical_1_var_800_wt': 5831.8505859375,\n 'cc_mock_numerical_1_max_800': 99.43800354003906,\n 'cc_mock_numerical_1_min_800': 0.4690000116825104,\n 'cc_mock_numerical_1_sum_1600_nw': 2528.3251953125,\n 'cc_mock_numerical_1_sum_1600_wt': 541.5323486328125,\n 'cc_mock_numerical_1_mean_1600_nw': 51.598472595214844,\n 'cc_mock_numerical_1_mean_1600_wt': 48.46938705444336,\n 'cc_mock_numerical_1_count_1600_nw': 49.0,\n 'cc_mock_numerical_1_count_1600_wt': 11.172667503356934,\n 'cc_mock_numerical_1_var_1600_nw': 986.6461181640625,\n 'cc_mock_numerical_1_var_1600_wt': 4370.07763671875,\n 'cc_mock_numerical_1_max_1600': 99.43800354003906,\n 'cc_mock_numerical_1_min_1600': 0.4690000116825104}",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "examples/london_amenities.html",
    "href": "examples/london_amenities.html",
    "title": "London Amenities",
    "section": "",
    "text": "Install and update cityseer if necessary.\n# !pip install --upgrade cityseer",
    "crumbs": [
      "Accessibility",
      "London Amenities"
    ]
  },
  {
    "objectID": "examples/london_amenities.html#data-and-preparation",
    "href": "examples/london_amenities.html#data-and-preparation",
    "title": "London Amenities",
    "section": "Data and preparation",
    "text": "Data and preparation\nThis examples calculates landuse accessibility to pubs and restaurants for London\nFor additional information on network preparation, see the corresponding notebook on graph cleaning.\nThis example will make use of OSM data downloaded from the OSM API for a 5000m radius around London Soho.\nThe landuse amenity data is taken from OpenStreetMap via osmnx.\n\nfrom cityseer.tools import graphs, io\n\n# download from OSM\nlng, lat = -0.13396079424572427, 51.51371088849723\nbuffer = 5000\nplot_buffer = 3500\n# creates a WGS shapely polygon\npoly_wgs, _ = io.buffered_point_poly(lng, lat, buffer)\npoly_utm, _ = io.buffered_point_poly(lng, lat, buffer, projected=True)\nplot_bbox = poly_utm.centroid.buffer(plot_buffer).bounds\n\nPrepare the amenities GeoDataFrame.\n\n# prepare data layer\nfrom cityseer.metrics import layers\nfrom osmnx import features\n\ndata_gdf = features.features_from_place(\n    \"london\", tags={\"amenity\": [\"pub\", \"restaurant\"]}\n)\ndata_gdf = data_gdf.to_crs(\n    32630\n)  # to match EPSG code for UTM zone 30N per network data\ndata_gdf = data_gdf.loc[\"node\"]\ndata_gdf = data_gdf.reset_index(level=0, drop=True)\ndata_gdf.index = data_gdf.index.astype(str)\n# convert to the same UTM CRS as the network\ndata_gdf = data_gdf[[\"amenity\", \"geometry\"]]\nprint(data_gdf.head())\n\n      amenity                        geometry\n0         pub  POINT (694282.233 5720372.951)\n1  restaurant  POINT (694353.653 5720508.222)\n2         pub  POINT (694189.282 5720228.905)\n3         pub  POINT (695475.171 5721895.793)\n4         pub  POINT (709733.415 5720007.168)\n\n\nFetch and simplify the street network. The street network will be decomposed for a higher resolution analysis.\n\n# generate OSM graph from polygon\nG_utm = io.osm_graph_from_poly(poly_wgs, simplify=True, iron_edges=True)\n# decompose for higher resolution analysis\nG_decomp = graphs.nx_decompose(G_utm, 25)\n# prepare the data structures\nnodes_gdf, _edges_gdf, network_structure = io.network_structure_from_nx(\n    G_decomp, crs=32629\n)\n\nINFO:cityseer.tools.io:Converting networkX graph from EPSG code 4326 to EPSG code 32630.\nINFO:cityseer.tools.io:Processing node x, y coordinates.\n100%|██████████| 158974/158974 [00:00&lt;00:00, 448816.60it/s]\nINFO:cityseer.tools.io:Processing edge geom coordinates, if present.\n100%|██████████| 174746/174746 [00:00&lt;00:00, 958047.36it/s]\nINFO:cityseer.tools.graphs:Generating interpolated edge geometries.\n100%|██████████| 174746/174746 [00:02&lt;00:00, 69522.98it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 158974/158974 [00:20&lt;00:00, 7661.52it/s]\nINFO:cityseer.tools.graphs:Removing dangling nodes.\n100%|██████████| 51042/51042 [00:00&lt;00:00, 281125.34it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 44125/44125 [00:01&lt;00:00, 41301.46it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 40426/40426 [00:00&lt;00:00, 100086.85it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 40426/40426 [00:11&lt;00:00, 3640.98it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 28513/28513 [00:00&lt;00:00, 159276.17it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 50.\n100%|██████████| 43571/43571 [00:03&lt;00:00, 11934.13it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 40139/40139 [00:00&lt;00:00, 691922.69it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 28135/28135 [00:11&lt;00:00, 2433.05it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 50.\n100%|██████████| 41835/41835 [00:00&lt;00:00, 220327.91it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 29831/29831 [00:00&lt;00:00, 100799.57it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 29831/29831 [00:05&lt;00:00, 5392.59it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 25797/25797 [00:00&lt;00:00, 59691.08it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 50.\n100%|██████████| 37634/37634 [00:01&lt;00:00, 20032.03it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 24356/24356 [00:00&lt;00:00, 132270.32it/s]\nINFO:cityseer.tools.graphs:Ironing edges.\n100%|██████████| 34781/34781 [00:10&lt;00:00, 3355.07it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 1.\n100%|██████████| 34781/34781 [00:00&lt;00:00, 189489.49it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 34779/34779 [00:00&lt;00:00, 719880.47it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 23771/23771 [00:06&lt;00:00, 3438.18it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 50.\n100%|██████████| 34993/34993 [00:00&lt;00:00, 55171.39it/s] \nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 23985/23985 [00:00&lt;00:00, 109008.42it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 23985/23985 [00:02&lt;00:00, 10589.26it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 23634/23634 [00:00&lt;00:00, 429373.54it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 50.\n100%|██████████| 34563/34563 [00:00&lt;00:00, 117906.15it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 23568/23568 [00:00&lt;00:00, 474414.40it/s]\nINFO:cityseer.tools.graphs:Ironing edges.\n100%|██████████| 34323/34323 [00:10&lt;00:00, 3345.77it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 1.\n100%|██████████| 34323/34323 [00:00&lt;00:00, 193568.69it/s]\nINFO:cityseer.tools.graphs:Decomposing graph to maximum edge lengths of 25.\n100%|██████████| 34322/34322 [00:16&lt;00:00, 2081.67it/s]\nINFO:cityseer.tools.io:Preparing node and edge arrays from networkX graph.\n100%|██████████| 90342/90342 [00:01&lt;00:00, 83076.16it/s] \n100%|██████████| 90342/90342 [00:13&lt;00:00, 6772.80it/s]\n\n\n\n# compute pub accessibility\ndistances = [100, 200, 400, 800]\nnodes_gdf, pubs_data_gdf = layers.compute_accessibilities(\n    data_gdf,\n    landuse_column_label=\"amenity\",\n    accessibility_keys=[\"pub\", \"restaurant\"],\n    nodes_gdf=nodes_gdf,\n    network_structure=network_structure,\n    distances=distances,\n)\n\nINFO:cityseer.metrics.layers:Computing land-use accessibility for: pub, restaurant\n100%|██████████| 90342/90342 [01:08&lt;00:00, 1324.37it/s]\n\n\nThe output GeoDataFrame will contain new columns for each landuse and distance combination. For each of these the following will have been computed:\n\nA count of reachable instances of a given landuse (within the specified distance thresholds)\nSimilarly, a distance-weighted count of reachable locations\nThe distance to the nearest instance of a given landuse. Where there are no reachable landuses for a given node within the specified distance threshold, then a np.inf value will be returned.\n\n\nimport matplotlib.pyplot as plt\nimport numpy as np\nfrom cityseer import rustalgos\nfrom cityseer.tools import plot\n\nbg_colour = \"#111\"\ntext_colour = \"#ddd\"\nfont_size = 5\nbetas = rustalgos.betas_from_distances(distances)\navg_dists = rustalgos.avg_distances_for_betas(betas)\nfor d, b, avg_d in zip(distances, betas, avg_dists):\n    fig, axes = plt.subplots(2, 1, figsize=(8, 8), dpi=200, facecolor=bg_colour)\n    fig.suptitle(\n        f\"Accessibilities at avg. walking tolerance: {avg_d:.2f}m and max tolerance of {d}m\",\n        color=text_colour,\n        fontsize=7,\n    )\n    plot.plot_scatter(\n        axes[0],\n        network_structure.node_xs,\n        network_structure.node_ys,\n        nodes_gdf[f\"cc_pub_{d}_wt\"],\n        bbox_extents=plot_bbox,\n        cmap_key=\"viridis\",\n        s_min=0.2,\n        s_max=2,\n        face_colour=bg_colour,\n    )\n    axes[0].set_title(\n        \"Number of pubs within walking tolerance.\",\n        color=text_colour,\n        fontsize=font_size,\n    )\n    plot.plot_scatter(\n        axes[1],\n        network_structure.node_xs,\n        network_structure.node_ys,\n        nodes_gdf[f\"cc_restaurant_{d}_wt\"],\n        bbox_extents=plot_bbox,\n        cmap_key=\"plasma\",\n        s_min=0.2,\n        s_max=2,\n        face_colour=bg_colour,\n    )\n    axes[1].set_title(\n        \"Number of restaurants within walking tolerance.\",\n        color=text_colour,\n        fontsize=font_size,\n    )\n    fig.tight_layout()\n    plt.show()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfig, axes = plt.subplots(2, 1, figsize=(8, 8), dpi=200, facecolor=bg_colour)\nfig.suptitle(\n    f\"Distances to nearest instance of specified landuse\",\n    color=text_colour,\n    fontsize=7,\n)\ndist_data = nodes_gdf[f\"cc_pub_nearest_max_{max(distances)}\"]\ndist_data[np.isinf(dist_data)] = max(distances)\nplot.plot_scatter(\n    axes[0],\n    network_structure.node_xs,\n    network_structure.node_ys,\n    dist_data,\n    bbox_extents=plot_bbox,\n    cmap_key=\"inferno_r\",\n    s_min=0.2,\n    s_max=0.21,\n    face_colour=bg_colour,\n)\naxes[0].set_title(\"Distance to nearest pub.\", color=text_colour, fontsize=font_size)\ndist_data = nodes_gdf[f\"cc_restaurant_nearest_max_{max(distances)}\"]\ndist_data[np.isinf(dist_data)] = max(distances)\nplot.plot_scatter(\n    axes[1],\n    network_structure.node_xs,\n    network_structure.node_ys,\n    dist_data,\n    bbox_extents=plot_bbox,\n    cmap_key=\"viridis_r\",\n    s_min=0.2,\n    s_max=0.21,\n    face_colour=bg_colour,\n)\naxes[1].set_title(\n    \"Distance to nearest restaurant.\", color=text_colour, fontsize=font_size\n)\n\n/var/folders/bs/sq3p18cs4dn1ws4kpmfyk_3c0000gn/T/ipykernel_66498/4173652336.py:8: SettingWithCopyWarning: \nA value is trying to be set on a copy of a slice from a DataFrame\n\nSee the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n  dist_data[np.isinf(dist_data)] = max(distances)\n/var/folders/bs/sq3p18cs4dn1ws4kpmfyk_3c0000gn/T/ipykernel_66498/4173652336.py:22: SettingWithCopyWarning: \nA value is trying to be set on a copy of a slice from a DataFrame\n\nSee the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n  dist_data[np.isinf(dist_data)] = max(distances)\n\n\nText(0.5, 1.0, 'Distance to nearest restaurant.')",
    "crumbs": [
      "Accessibility",
      "London Amenities"
    ]
  },
  {
    "objectID": "examples/continuity/continuity_os_open.html",
    "href": "examples/continuity/continuity_os_open.html",
    "title": "OS Open Roads",
    "section": "",
    "text": "The following example uses the OS Open Roads dataset, which is available under the Open Government License.\n© Crown copyright and database right 2022",
    "crumbs": [
      "Continuity",
      "OS Open Roads"
    ]
  },
  {
    "objectID": "examples/continuity/continuity_os_open.html#data-source",
    "href": "examples/continuity/continuity_os_open.html#data-source",
    "title": "OS Open Roads",
    "section": "",
    "text": "The following example uses the OS Open Roads dataset, which is available under the Open Government License.\n© Crown copyright and database right 2022",
    "crumbs": [
      "Continuity",
      "OS Open Roads"
    ]
  },
  {
    "objectID": "examples/continuity/continuity_os_open.html#preparation",
    "href": "examples/continuity/continuity_os_open.html#preparation",
    "title": "OS Open Roads",
    "section": "Preparation",
    "text": "Preparation\nThe following example assumes:\n\nThat the notebook is being run from a cloned cityseer-api repository.\nThat the above dataset has been downloaded to temp/os_open_roads/oproad_gb.gpkg as a relative path. If running this notebook directly from within a clone of the cityseer-api repo, then this equates to the cityseer-api/temp/os_open_roads/oproad_gb.gpkg path. Please edit the paths and path setup in this cell if you are using different directories.\n\n\nfrom __future__ import annotations\n\nfrom pathlib import Path\n\nrepo_path = Path.cwd()\nif str(repo_path).endswith(\"continuity\"):\n    repo_path = Path.cwd() / \"../..\"\nif not str(repo_path.resolve()).endswith(\"cityseer-examples\"):\n    raise ValueError(\n        \"Please check your notebook working directory relative to your project and data paths.\"\n    )\n\nopen_roads_path = Path(repo_path / \"temp/os_open_roads/oproad_gb.gpkg\")\nprint(\"data path:\", open_roads_path)\nprint(\"path exists:\", open_roads_path.exists())\n\ndata path: /Users/gareth/dev/benchmark-urbanism/cityseer-examples/examples/continuity/../../temp/os_open_roads/oproad_gb.gpkg\npath exists: True\n\n\n\nExtents\nInstead of loading the entire dataset, we’ll use a bounding box to only load an area of interest.\n\nfrom pyproj import Transformer\nfrom shapely import geometry\n\nfrom cityseer.tools import io\n\n# create graph - only UK locations will work for OS Open Roads data\n# stratford-upon-avon\n# lng, lat, buffer_dist, plot_buffer = -1.7063649924889566, 52.19277374082795, 2500, 2000\n# london\nlng, lat, buffer_dist, plot_buffer = (\n    -0.13039709427587876,\n    51.516434828344366,\n    6000,\n    5000,\n)\n# transform from WGS to BNG\ntransformer = Transformer.from_crs(\"EPSG:4326\", \"EPSG:27700\")\neasting, northing = transformer.transform(lat, lng)\n# calculate bbox relative to centroid\ncentroid = geometry.Point(easting, northing)\ntarget_bbox: tuple[float, float, float, float] = centroid.buffer(buffer_dist).bounds  # type: ignore\nplot_bbox: tuple[float, float, float, float] = centroid.buffer(plot_buffer).bounds  # type: ignore\n\n\n\nLoad\nWe can now load the OS Open Roads dataset\n\n# load OS Open Roads data from downloaded geopackage\nG_open = io.nx_from_open_roads(open_roads_path, target_bbox=target_bbox)\n\nINFO:cityseer.tools.io:Nodes: 24778\nINFO:cityseer.tools.io:Edges: 32723\nINFO:cityseer.tools.io:Dropped 463 edges where not both start and end nodes were present.\nINFO:cityseer.tools.io:Running basic graph cleaning\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 24778/24778 [00:00&lt;00:00, 33240.53it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 10.\n100%|██████████| 30681/30681 [00:00&lt;00:00, 50838.55it/s]",
    "crumbs": [
      "Continuity",
      "OS Open Roads"
    ]
  },
  {
    "objectID": "examples/continuity/continuity_os_open.html#observe-continuity-metrics",
    "href": "examples/continuity/continuity_os_open.html#observe-continuity-metrics",
    "title": "OS Open Roads",
    "section": "Observe continuity metrics",
    "text": "Observe continuity metrics\nThis step runs the continuity analysis using the specified heuristic.\n\nimport matplotlib.pyplot as plt\n\nfrom cityseer.tools import io, plot\nfrom cityseer.metrics import observe\n\n# methods can be \"names\", \"routes\", \"highways\"\n\nprint(\"Continuity by street names\")\nG_cont, NamesContReport = observe.street_continuity(G_open, method=\"names\")\nNamesContReport.report_by_count(n_items=5)\nNamesContReport.report_by_length(n_items=5)\n\nprint(\"Continuity by route numbers\")\nG_cont, RoutesContReport = observe.street_continuity(G_cont, method=\"routes\")\nRoutesContReport.report_by_count(n_items=5)\nRoutesContReport.report_by_length(n_items=5)\n\nprint(\"Continuity by highway types\")\nG_cont, HwyContReport = observe.street_continuity(G_cont, method=\"highways\")\nHwyContReport.report_by_count(n_items=5)\nHwyContReport.report_by_length(n_items=5)\n\nprint(\"Continuity by overlapping routes and names types\")\nG_cont, HybridContReport = observe.hybrid_street_continuity(G_cont)\nHybridContReport.report_by_count(n_items=5)\nHybridContReport.report_by_length(n_items=5)\n\nContinuity by street names\n\n\nINFO:cityseer.metrics.observe:Calculating metrics for names.\n100%|██████████| 30609/30609 [00:00&lt;00:00, 31274.62it/s]\nINFO:cityseer.metrics.observe:Reporting top 5 continuity observations by street counts.\nINFO:cityseer.metrics.observe:Count: 82 - finchley road\nINFO:cityseer.metrics.observe:Count: 62 - harrow road\nINFO:cityseer.metrics.observe:Count: 58 - old kent road\nINFO:cityseer.metrics.observe:Count: 57 - king's road\nINFO:cityseer.metrics.observe:Count: 46 - clapham road\nINFO:cityseer.metrics.observe:Reporting top 5 continuity observations by street lengths.\nINFO:cityseer.metrics.observe:Length: 5.4km - harrow road\nINFO:cityseer.metrics.observe:Length: 5.34km - finchley road\nINFO:cityseer.metrics.observe:Length: 4.48km - outer circle\nINFO:cityseer.metrics.observe:Length: 3.7km - westway\nINFO:cityseer.metrics.observe:Length: 3.28km - old kent road\n\n\nContinuity by route numbers\n\n\nINFO:cityseer.metrics.observe:Calculating metrics for routes.\n100%|██████████| 30609/30609 [00:00&lt;00:00, 109845.11it/s]\nINFO:cityseer.metrics.observe:Reporting top 5 continuity observations by street counts.\nINFO:cityseer.metrics.observe:Count: 142 - a1\nINFO:cityseer.metrics.observe:Count: 135 - a10\nINFO:cityseer.metrics.observe:Count: 129 - a41\nINFO:cityseer.metrics.observe:Count: 128 - a107\nINFO:cityseer.metrics.observe:Count: 116 - a5\nINFO:cityseer.metrics.observe:Reporting top 5 continuity observations by street lengths.\nINFO:cityseer.metrics.observe:Length: 9.1km - a41\nINFO:cityseer.metrics.observe:Length: 8.1km - a1\nINFO:cityseer.metrics.observe:Length: 7.96km - a10\nINFO:cityseer.metrics.observe:Length: 7.76km - a3220\nINFO:cityseer.metrics.observe:Length: 7.12km - a107\n\n\nContinuity by highway types\n\n\nINFO:cityseer.metrics.observe:Calculating metrics for highways.\n100%|██████████| 30609/30609 [00:00&lt;00:00, 156124.61it/s]\nINFO:cityseer.metrics.observe:Reporting top 5 continuity observations by street counts.\nINFO:cityseer.metrics.observe:Count: 5056 - a road\nINFO:cityseer.metrics.observe:Count: 2510 - minor road\nINFO:cityseer.metrics.observe:Count: 1711 - primary road\nINFO:cityseer.metrics.observe:Count: 1487 - b road\nINFO:cityseer.metrics.observe:Count: 463 - secondary access road\nINFO:cityseer.metrics.observe:Reporting top 5 continuity observations by street lengths.\nINFO:cityseer.metrics.observe:Length: 336.17km - a road\nINFO:cityseer.metrics.observe:Length: 181.0km - minor road\nINFO:cityseer.metrics.observe:Length: 116.88km - primary road\nINFO:cityseer.metrics.observe:Length: 105.99km - b road\nINFO:cityseer.metrics.observe:Length: 33.74km - secondary access road\n\n\nContinuity by overlapping routes and names types\n\n\nINFO:cityseer.metrics.observe:Calculating metrics for routes.\n100%|██████████| 30609/30609 [00:00&lt;00:00, 118874.56it/s]\nINFO:cityseer.metrics.observe:Reporting top 5 continuity observations by street counts.\nINFO:cityseer.metrics.observe:Count: 230 - a1\nINFO:cityseer.metrics.observe:Count: 204 - a41\nINFO:cityseer.metrics.observe:Count: 162 - a40\nINFO:cityseer.metrics.observe:Count: 162 - a10\nINFO:cityseer.metrics.observe:Count: 154 - a107\nINFO:cityseer.metrics.observe:Reporting top 5 continuity observations by street lengths.\nINFO:cityseer.metrics.observe:Length: 14.76km - a41\nINFO:cityseer.metrics.observe:Length: 13.1km - a1\nINFO:cityseer.metrics.observe:Length: 12.38km - a40\nINFO:cityseer.metrics.observe:Length: 10.98km - a3220\nINFO:cityseer.metrics.observe:Length: 9.46km - a10\n\n\n\nfor method, shape_exp, descriptor, cmap, inverse, col_by_categ in zip(\n    [\"names\", \"routes\", \"highways\", \"hybrid\"],  #\n    [1, 0.75, 0.5, 1],  #\n    [\"Street names\", \"Routes\", \"Road types\", \"Hybrid routes & names\"],  #\n    [\"plasma\", \"viridis\", \"tab10\", \"tab10\"],  #\n    [False, False, True, False],  #\n    [False, False, True, True],\n):\n    print(f\"Plotting results for method: {method}\")\n    # plot\n    bg_colour = \"#111\"\n    fig, axes = plt.subplots(\n        2, 1, dpi=150, figsize=(8, 12), facecolor=bg_colour, constrained_layout=True\n    )\n    fig.suptitle(\n        f\"OS Open Roads plotted by {descriptor} continuity\",\n        fontsize=\"small\",\n        ha=\"center\",\n    )\n    # by count\n    plot.plot_nx_edges(\n        axes[0],  # type: ignore\n        nx_multigraph=G_cont,\n        edge_metrics_key=f\"{method}_cont_by_count\",\n        bbox_extents=plot_bbox,\n        cmap_key=cmap,\n        lw_min=0.5,\n        lw_max=2,\n        edge_label_key=f\"{method}_cont_by_label\",\n        colour_by_categorical=col_by_categ,\n        shape_exp=shape_exp,\n        face_colour=bg_colour,\n        invert_plot_order=inverse,\n    )\n    axes[0].set_xlabel(f\"{descriptor} by count\", fontsize=\"x-small\")  # type: ignore\n    # by length\n    plot.plot_nx_edges(\n        axes[1],  # type: ignore\n        nx_multigraph=G_cont,\n        edge_metrics_key=f\"{method}_cont_by_length\",\n        bbox_extents=plot_bbox,\n        cmap_key=cmap,\n        lw_min=0.5,\n        lw_max=2,\n        edge_label_key=f\"{method}_cont_by_label\",\n        colour_by_categorical=col_by_categ,\n        shape_exp=shape_exp,\n        face_colour=bg_colour,\n        invert_plot_order=inverse,\n    )\n    axes[1].set_xlabel(f\"{descriptor} by length (metres)\", fontsize=\"x-small\")  # type: ignore\n    plt.show()\n\nINFO:cityseer.tools.plot:Extracting edge geometries\n\n\nPlotting results for method: names\n\n\n30609it [00:00, 469577.59it/s]\nINFO:cityseer.tools.plot:Generating plot\n100%|██████████| 30609/30609 [00:02&lt;00:00, 11117.21it/s]\nINFO:cityseer.tools.plot:Extracting edge geometries\n30609it [00:00, 545878.18it/s]\nINFO:cityseer.tools.plot:Generating plot\n100%|██████████| 30609/30609 [00:03&lt;00:00, 10180.88it/s]\n\n\n\n\n\n\n\n\n\nINFO:cityseer.tools.plot:Extracting edge geometries\n\n\nPlotting results for method: routes\n\n\n30609it [00:00, 464096.40it/s]\nINFO:cityseer.tools.plot:Generating plot\n100%|██████████| 30609/30609 [00:03&lt;00:00, 9764.13it/s] \nINFO:cityseer.tools.plot:Extracting edge geometries\n30609it [00:00, 694550.28it/s]\nINFO:cityseer.tools.plot:Generating plot\n100%|██████████| 30609/30609 [00:03&lt;00:00, 8866.57it/s] \n\n\n\n\n\n\n\n\n\nINFO:cityseer.tools.plot:Extracting edge geometries\n\n\nPlotting results for method: highways\n\n\n30609it [00:00, 532384.47it/s]\nINFO:cityseer.tools.plot:Generating plot\n100%|██████████| 6/6 [00:02&lt;00:00,  2.75it/s]\nINFO:cityseer.tools.plot:Extracting edge geometries\n30609it [00:00, 593554.44it/s]\nINFO:cityseer.tools.plot:Generating plot\n100%|██████████| 6/6 [00:02&lt;00:00,  2.96it/s]\n\n\n\n\n\n\n\n\n\nINFO:cityseer.tools.plot:Extracting edge geometries\n\n\nPlotting results for method: hybrid\n\n\n30609it [00:00, 652573.79it/s]\nINFO:cityseer.tools.plot:Generating plot\n100%|██████████| 11/11 [00:02&lt;00:00,  5.26it/s]\nINFO:cityseer.tools.plot:Extracting edge geometries\n30609it [00:00, 700114.25it/s]\nINFO:cityseer.tools.plot:Generating plot\n100%|██████████| 11/11 [00:01&lt;00:00,  5.77it/s]",
    "crumbs": [
      "Continuity",
      "OS Open Roads"
    ]
  },
  {
    "objectID": "examples/osm_to_cityseer.html",
    "href": "examples/osm_to_cityseer.html",
    "title": "OSM - cityseer",
    "section": "",
    "text": "See the accompanying discussion in the guide.\nInstall and update cityseer if necessary.\n# !pip install --upgrade cityseer\n# !pip install osmnx",
    "crumbs": [
      "Conversion",
      "OSM - cityseer"
    ]
  },
  {
    "objectID": "examples/osm_to_cityseer.html#setup",
    "href": "examples/osm_to_cityseer.html#setup",
    "title": "OSM - cityseer",
    "section": "Setup",
    "text": "Setup\nIf you’re prepared to get your hands dirty, it is possible to directly query the OSM API and to then use this data to create a cityseer graph. This can be preferred in situations where you want detailed control over the structure of the OSM API query. However, if you prefer, OSM data can also be retrieved with OSMnx and then converted into a cityseer compatible networkX graph.\nThe following example makes use of data for London Soho.\n\nimport osmnx as ox\nfrom shapely import geometry\nimport utm\n\nfrom cityseer.tools import graphs, plot, io\n\n# centrepoint\nlng, lat = -0.13396079424572427, 51.51371088849723\n\n# select extents for plotting\neasting, northing = utm.from_latlon(lat, lng)[:2]\nbuffer_dist = 1250\nbuffer_poly = geometry.Point(easting, northing).buffer(1000)\nmin_x, min_y, max_x, max_y = buffer_poly.bounds\n\n\n# reusable plot function\ndef simple_plot(_G):\n    # plot using the selected extents\n    plot.plot_nx(\n        _G,\n        labels=False,\n        plot_geoms=True,\n        node_size=4,\n        edge_width=1,\n        x_lim=(min_x, max_x),\n        y_lim=(min_y, max_y),\n        figsize=(6, 6),\n        dpi=150,\n    )\n\n\n# Let's use OSMnx to fetch an OSM graph\n# We'll use the same raw network for both workflows (hence simplify=False)\nmulti_di_graph_raw = ox.graph_from_point((lat, lng), dist=buffer_dist, simplify=False)",
    "crumbs": [
      "Conversion",
      "OSM - cityseer"
    ]
  },
  {
    "objectID": "examples/osm_to_cityseer.html#workflow-1",
    "href": "examples/osm_to_cityseer.html#workflow-1",
    "title": "OSM - cityseer",
    "section": "Workflow 1",
    "text": "Workflow 1\nOne option is to both download and simplify the data in OSMnx and to then convert the graph from OSMnx to cityseer (per the io.nx_from_osm_nx method).\n\n# Workflow 1: Using OSMnx to prepare the graph\n# ============================================\n# explicit simplification and consolidation via OSMnx\nmulti_di_graph_utm = ox.project_graph(multi_di_graph_raw)\nmulti_di_graph_simpl = ox.simplify_graph(multi_di_graph_utm)\nmulti_di_graph_cons = ox.consolidate_intersections(\n    multi_di_graph_simpl, tolerance=10, dead_ends=True\n)\n# let's use the same plotting function for both scenarios to aid visual comparisons\nmulti_graph_cons = io.nx_from_osm_nx(multi_di_graph_cons, tolerance=50)\nsimple_plot(multi_graph_cons)\n\nINFO:cityseer.tools.io:Converting OSMnx MultiDiGraph to cityseer MultiGraph.\n100%|██████████| 6036/6036 [00:01&lt;00:00, 4437.64it/s]\nINFO:cityseer.tools.plot:Preparing graph nodes\nINFO:cityseer.tools.plot:Preparing graph edges\n100%|██████████| 3595/3595 [00:00&lt;00:00, 20294.44it/s]",
    "crumbs": [
      "Conversion",
      "OSM - cityseer"
    ]
  },
  {
    "objectID": "examples/osm_to_cityseer.html#workflow-2",
    "href": "examples/osm_to_cityseer.html#workflow-2",
    "title": "OSM - cityseer",
    "section": "Workflow 2",
    "text": "Workflow 2\nAnother option is to immediately convert the osmnx graph to cityseer before downstream processing. This is preferable because it is then easier for cityseer to retain the integrity of the roadway geometries while enforcing node coordinate validation for intersections.\n\n# WORKFLOW 2: Using cityseer to manually clean an OSMnx graph\n# ===========================================================\nG_raw = io.nx_from_osm_nx(multi_di_graph_raw)\n\nINFO:cityseer.tools.io:Converting OSMnx MultiDiGraph to cityseer MultiGraph.\n100%|██████████| 30898/30898 [00:07&lt;00:00, 4326.17it/s]\n\n\n\nG = io.nx_wgs_to_utm(G_raw)\nG = graphs.nx_simple_geoms(G)\nG = graphs.nx_remove_filler_nodes(G)\nG = graphs.nx_remove_dangling_nodes(G)\n\nINFO:cityseer.tools.io:Converting networkX graph from EPSG code 4326 to EPSG code 32630.\nINFO:cityseer.tools.io:Processing node x, y coordinates.\n100%|██████████| 15843/15843 [00:00&lt;00:00, 312282.86it/s]\nINFO:cityseer.tools.io:Processing edge geom coordinates, if present.\n100%|██████████| 18245/18245 [00:02&lt;00:00, 6530.14it/s]\nINFO:cityseer.tools.graphs:Generating interpolated edge geometries.\n100%|██████████| 18245/18245 [00:00&lt;00:00, 39269.89it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 15843/15843 [00:02&lt;00:00, 6851.57it/s]\nINFO:cityseer.tools.graphs:Removing dangling nodes.\n100%|██████████| 5475/5475 [00:00&lt;00:00, 246880.26it/s]\n\n\n\nG1 = graphs.nx_consolidate_nodes(G, buffer_dist=12, crawl=True)\nG2 = graphs.nx_split_opposing_geoms(G1, buffer_dist=15)\nG3 = graphs.nx_consolidate_nodes(G2, buffer_dist=15, neighbour_policy=\"indirect\")\nG4 = graphs.nx_remove_filler_nodes(G3)\nG5 = graphs.nx_iron_edges(G4)\nsimple_plot(G5)\n\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 4989/4989 [00:00&lt;00:00, 67623.61it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 4989/4989 [00:02&lt;00:00, 2288.62it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 4656/4656 [00:00&lt;00:00, 9415.34it/s] \nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 4101/4101 [00:00&lt;00:00, 637493.17it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 2685/2685 [00:00&lt;00:00, 2979.42it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 4361/4361 [00:00&lt;00:00, 12188.54it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 2685/2685 [00:00&lt;00:00, 82508.78it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 2685/2685 [00:00&lt;00:00, 7964.17it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 3890/3890 [00:00&lt;00:00, 114301.42it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 2648/2648 [00:00&lt;00:00, 28091.59it/s]\nINFO:cityseer.tools.graphs:Ironing edges.\n100%|██████████| 3568/3568 [00:00&lt;00:00, 4297.52it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 1.\n100%|██████████| 3568/3568 [00:00&lt;00:00, 34758.11it/s]\nINFO:cityseer.tools.plot:Preparing graph nodes\nINFO:cityseer.tools.plot:Preparing graph edges\n100%|██████████| 3560/3560 [00:00&lt;00:00, 25998.14it/s]",
    "crumbs": [
      "Conversion",
      "OSM - cityseer"
    ]
  },
  {
    "objectID": "examples/osm_to_cityseer.html#workflow-3",
    "href": "examples/osm_to_cityseer.html#workflow-3",
    "title": "OSM - cityseer",
    "section": "Workflow 3",
    "text": "Workflow 3\nA further option is to simply download the OSM graph directly from within cityseer. The following uses a default OSM query, however, the OSM Overpass API can be used to roll-your-own. See documentation for more information.\n\n# WORKFLOW 3: Using cityseer to download and automatically simplify the graph\n# ===========================================================================\npoly_wgs, _ = io.buffered_point_poly(lng, lat, buffer_dist)\nG_utm = io.osm_graph_from_poly(poly_wgs, simplify=True)\nsimple_plot(G_utm)\n\nINFO:cityseer.tools.io:Converting networkX graph from EPSG code 4326 to EPSG code 32630.\nINFO:cityseer.tools.io:Processing node x, y coordinates.\n100%|██████████| 12429/12429 [00:00&lt;00:00, 411966.02it/s]\nINFO:cityseer.tools.io:Processing edge geom coordinates, if present.\n100%|██████████| 13773/13773 [00:00&lt;00:00, 792593.11it/s]\nINFO:cityseer.tools.graphs:Generating interpolated edge geometries.\n100%|██████████| 13773/13773 [00:00&lt;00:00, 63453.10it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 12429/12429 [00:01&lt;00:00, 6430.53it/s]\nINFO:cityseer.tools.graphs:Removing dangling nodes.\n100%|██████████| 4170/4170 [00:00&lt;00:00, 162044.26it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 4781/4781 [00:00&lt;00:00, 550754.39it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 3358/3358 [00:00&lt;00:00, 90179.30it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 60.\n100%|██████████| 4781/4781 [00:00&lt;00:00, 128016.19it/s]\nWARNING:cityseer.tools.graphs:Be cautious with large buffer distances when using crawl!\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 3358/3358 [00:00&lt;00:00, 66223.78it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 3358/3358 [00:00&lt;00:00, 92212.08it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 60.\n100%|██████████| 4781/4781 [00:00&lt;00:00, 129266.40it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 3358/3358 [00:00&lt;00:00, 20936.70it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 4428/4428 [00:00&lt;00:00, 167363.96it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 3005/3005 [00:00&lt;00:00, 75603.19it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 40.\n100%|██████████| 4428/4428 [00:00&lt;00:00, 122649.05it/s]\nWARNING:cityseer.tools.graphs:Be cautious with large buffer distances when using crawl!\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 3005/3005 [00:00&lt;00:00, 64465.38it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 3005/3005 [00:00&lt;00:00, 77660.81it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 40.\n100%|██████████| 4428/4428 [00:00&lt;00:00, 88344.40it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 3005/3005 [00:00&lt;00:00, 626279.93it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 4428/4428 [00:00&lt;00:00, 15310.85it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 3005/3005 [00:01&lt;00:00, 2707.85it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 40.\n100%|██████████| 4595/4595 [00:00&lt;00:00, 26443.73it/s]\nWARNING:cityseer.tools.graphs:Be cautious with large buffer distances when using crawl!\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 3005/3005 [00:00&lt;00:00, 56759.42it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 3005/3005 [00:00&lt;00:00, 11112.55it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 40.\n100%|██████████| 3917/3917 [00:00&lt;00:00, 51039.13it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 2604/2604 [00:00&lt;00:00, 284618.95it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 3873/3873 [00:00&lt;00:00, 552967.95it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 2591/2591 [00:00&lt;00:00, 32198.68it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 30.\n100%|██████████| 3880/3880 [00:00&lt;00:00, 74537.74it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 2591/2591 [00:00&lt;00:00, 77438.18it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 2591/2591 [00:00&lt;00:00, 52761.23it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 30.\n100%|██████████| 3843/3843 [00:00&lt;00:00, 95931.00it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 2568/2568 [00:00&lt;00:00, 564427.64it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 3843/3843 [00:00&lt;00:00, 621432.27it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 2568/2568 [00:00&lt;00:00, 12985.37it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 30.\n100%|██████████| 3863/3863 [00:00&lt;00:00, 82458.06it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 2568/2568 [00:00&lt;00:00, 70683.56it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 2568/2568 [00:00&lt;00:00, 25106.81it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 30.\n100%|██████████| 3732/3732 [00:00&lt;00:00, 92279.78it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 2477/2477 [00:00&lt;00:00, 443683.42it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 3727/3727 [00:00&lt;00:00, 700837.08it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 2473/2473 [00:00&lt;00:00, 11369.32it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 3736/3736 [00:00&lt;00:00, 35870.42it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 2473/2473 [00:00&lt;00:00, 77869.97it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 2473/2473 [00:00&lt;00:00, 13033.01it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 3594/3594 [00:00&lt;00:00, 92849.09it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 2369/2369 [00:00&lt;00:00, 376932.07it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 3584/3584 [00:00&lt;00:00, 684223.28it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 2361/2361 [00:00&lt;00:00, 105637.24it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 30.\n100%|██████████| 3584/3584 [00:00&lt;00:00, 96317.61it/s]\nWARNING:cityseer.tools.graphs:Be cautious with large buffer distances when using crawl!\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 2361/2361 [00:00&lt;00:00, 75265.46it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 2361/2361 [00:00&lt;00:00, 118595.83it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 30.\n100%|██████████| 3584/3584 [00:00&lt;00:00, 93952.41it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 2361/2361 [00:00&lt;00:00, 521060.34it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 3584/3584 [00:00&lt;00:00, 657728.53it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 2361/2361 [00:00&lt;00:00, 25945.64it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 3588/3588 [00:00&lt;00:00, 84907.43it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 2361/2361 [00:00&lt;00:00, 74800.41it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 2361/2361 [00:00&lt;00:00, 35500.10it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 3564/3564 [00:00&lt;00:00, 47975.98it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 2351/2351 [00:00&lt;00:00, 133322.63it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 3563/3563 [00:00&lt;00:00, 521416.04it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 2351/2351 [00:00&lt;00:00, 34965.30it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 3563/3563 [00:00&lt;00:00, 89462.21it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 2351/2351 [00:00&lt;00:00, 80679.49it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 2351/2351 [00:00&lt;00:00, 44581.12it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 3556/3556 [00:00&lt;00:00, 103059.99it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 2349/2349 [00:00&lt;00:00, 524818.63it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 3554/3554 [00:00&lt;00:00, 651652.74it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 2347/2347 [00:01&lt;00:00, 2267.01it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 3867/3867 [00:00&lt;00:00, 14490.59it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 2347/2347 [00:00&lt;00:00, 71002.73it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 2347/2347 [00:00&lt;00:00, 3063.43it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 2912/2912 [00:00&lt;00:00, 19564.89it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 1925/1925 [00:00&lt;00:00, 57653.56it/s]\nINFO:cityseer.tools.graphs:Ironing edges.\n100%|██████████| 2754/2754 [00:00&lt;00:00, 3669.98it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 1.\n100%|██████████| 2754/2754 [00:00&lt;00:00, 164271.99it/s]\nINFO:cityseer.tools.plot:Preparing graph nodes\nINFO:cityseer.tools.plot:Preparing graph edges\n100%|██████████| 2754/2754 [00:00&lt;00:00, 25726.77it/s]",
    "crumbs": [
      "Conversion",
      "OSM - cityseer"
    ]
  },
  {
    "objectID": "examples/graph_cleaning.html",
    "href": "examples/graph_cleaning.html",
    "title": "Graph Cleaning",
    "section": "",
    "text": "Install and update cityseer if necessary.\n# !pip install --upgrade cityseer\nSee the guide for a preamble.\nPlease also see the graph corrections guide for an alternative approach.",
    "crumbs": [
      "Preparation",
      "Graph Cleaning"
    ]
  },
  {
    "objectID": "examples/graph_cleaning.html#downloading-data",
    "href": "examples/graph_cleaning.html#downloading-data",
    "title": "Graph Cleaning",
    "section": "Downloading data",
    "text": "Downloading data\nThis example will make use of OSM data downloaded from the OSM API. To keep things interesting, let’s pick London Soho, which will be buffered and cleaned for a 1,250m radius.\n\nfrom shapely import geometry\nimport utm\n\nfrom cityseer.tools import graphs, plot, io\n\n# Let's download data within a 1,250m buffer around London Soho:\nlng, lat = -0.13396079424572427, 51.51371088849723\n# lng, lat = 2.166981, 41.389526 -- Barcelona - which is a complex case\nbuffer = 1250\n# creates a WGS shapely polygon\npoly_wgs, _ = io.buffered_point_poly(lng, lat, buffer)\n# use a WGS shapely polygon to download information from OSM\n# this version will not simplify\nG_raw = io.osm_graph_from_poly(poly_wgs, simplify=False)\n# whereas this version does simplify\nG_utm = io.osm_graph_from_poly(poly_wgs)\n\n# select extents for clipping the plotting extents\neasting, northing = utm.from_latlon(lat, lng)[:2]\nbuff = geometry.Point(easting, northing).buffer(1000)\nmin_x, min_y, max_x, max_y = buff.bounds\n\n\n# reusable plot function\ndef simple_plot(_G, plot_geoms=True):\n    # plot using the selected extents\n    plot.plot_nx(\n        _G,\n        labels=False,\n        plot_geoms=plot_geoms,\n        node_size=4,\n        edge_width=1,\n        x_lim=(min_x, max_x),\n        y_lim=(min_y, max_y),\n        figsize=(6, 6),\n        dpi=150,\n    )\n\nINFO:cityseer.tools.io:Converting networkX graph from EPSG code 4326 to EPSG code 32630.\nINFO:cityseer.tools.io:Processing node x, y coordinates.\n100%|██████████| 12429/12429 [00:00&lt;00:00, 303680.47it/s]\nINFO:cityseer.tools.io:Processing edge geom coordinates, if present.\n100%|██████████| 13773/13773 [00:00&lt;00:00, 705866.92it/s]\nINFO:cityseer.tools.graphs:Generating interpolated edge geometries.\n100%|██████████| 13773/13773 [00:00&lt;00:00, 29654.56it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 12429/12429 [00:02&lt;00:00, 4186.89it/s]\nINFO:cityseer.tools.graphs:Ironing edges.\n100%|██████████| 5741/5741 [00:02&lt;00:00, 2305.88it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 1.\n100%|██████████| 5741/5741 [00:00&lt;00:00, 94840.76it/s]\nINFO:cityseer.tools.io:Converting networkX graph from EPSG code 4326 to EPSG code 32630.\nINFO:cityseer.tools.io:Processing node x, y coordinates.\n100%|██████████| 12429/12429 [00:00&lt;00:00, 360898.07it/s]\nINFO:cityseer.tools.io:Processing edge geom coordinates, if present.\n100%|██████████| 13773/13773 [00:00&lt;00:00, 387534.04it/s]\nINFO:cityseer.tools.graphs:Generating interpolated edge geometries.\n100%|██████████| 13773/13773 [00:00&lt;00:00, 53904.99it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 12429/12429 [00:02&lt;00:00, 5440.01it/s]\nINFO:cityseer.tools.graphs:Removing dangling nodes.\n100%|██████████| 4170/4170 [00:00&lt;00:00, 129302.62it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 4781/4781 [00:00&lt;00:00, 529102.04it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 3358/3358 [00:00&lt;00:00, 59286.57it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 60.\n100%|██████████| 4781/4781 [00:00&lt;00:00, 95049.92it/s]\nWARNING:cityseer.tools.graphs:Be cautious with large buffer distances when using crawl!\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 3358/3358 [00:00&lt;00:00, 76015.59it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 3358/3358 [00:00&lt;00:00, 69445.95it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 60.\n100%|██████████| 4781/4781 [00:00&lt;00:00, 114110.43it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 3358/3358 [00:00&lt;00:00, 23833.85it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 4428/4428 [00:00&lt;00:00, 30054.39it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 3005/3005 [00:00&lt;00:00, 61930.68it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 40.\n100%|██████████| 4428/4428 [00:00&lt;00:00, 94363.69it/s]\nWARNING:cityseer.tools.graphs:Be cautious with large buffer distances when using crawl!\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 3005/3005 [00:00&lt;00:00, 47486.74it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 3005/3005 [00:00&lt;00:00, 68326.32it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 40.\n100%|██████████| 4428/4428 [00:00&lt;00:00, 102651.79it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 3005/3005 [00:00&lt;00:00, 504215.85it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 4428/4428 [00:00&lt;00:00, 388316.01it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 3005/3005 [00:01&lt;00:00, 2599.51it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 40.\n100%|██████████| 4595/4595 [00:00&lt;00:00, 14529.93it/s]\nWARNING:cityseer.tools.graphs:Be cautious with large buffer distances when using crawl!\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 3005/3005 [00:00&lt;00:00, 72605.53it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 3005/3005 [00:00&lt;00:00, 11083.19it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 40.\n100%|██████████| 3917/3917 [00:00&lt;00:00, 49944.64it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 2604/2604 [00:00&lt;00:00, 190354.46it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 3873/3873 [00:00&lt;00:00, 125609.23it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 2591/2591 [00:00&lt;00:00, 28315.30it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 30.\n100%|██████████| 3880/3880 [00:00&lt;00:00, 62688.85it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 2591/2591 [00:00&lt;00:00, 46261.17it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 2591/2591 [00:00&lt;00:00, 45728.77it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 30.\n100%|██████████| 3843/3843 [00:00&lt;00:00, 87162.56it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 2568/2568 [00:00&lt;00:00, 498448.46it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 3843/3843 [00:00&lt;00:00, 393628.91it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 2568/2568 [00:00&lt;00:00, 10225.61it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 30.\n100%|██████████| 3863/3863 [00:00&lt;00:00, 46736.46it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 2568/2568 [00:00&lt;00:00, 47990.22it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 2568/2568 [00:00&lt;00:00, 21975.16it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 30.\n100%|██████████| 3730/3730 [00:00&lt;00:00, 76070.96it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 2476/2476 [00:00&lt;00:00, 392260.50it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 3725/3725 [00:00&lt;00:00, 582411.93it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 2472/2472 [00:00&lt;00:00, 11019.44it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 3734/3734 [00:00&lt;00:00, 50643.76it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 2472/2472 [00:00&lt;00:00, 10906.68it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 2472/2472 [00:00&lt;00:00, 8319.65it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 3591/3591 [00:00&lt;00:00, 75974.26it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 2368/2368 [00:00&lt;00:00, 343897.78it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 3581/3581 [00:00&lt;00:00, 469339.50it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 2360/2360 [00:00&lt;00:00, 55182.98it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 30.\n100%|██████████| 3581/3581 [00:00&lt;00:00, 67408.09it/s]\nWARNING:cityseer.tools.graphs:Be cautious with large buffer distances when using crawl!\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 2360/2360 [00:00&lt;00:00, 44965.24it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 2360/2360 [00:00&lt;00:00, 75735.53it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 30.\n100%|██████████| 3581/3581 [00:00&lt;00:00, 71812.51it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 2360/2360 [00:00&lt;00:00, 554106.44it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 3581/3581 [00:00&lt;00:00, 25060.15it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 2360/2360 [00:00&lt;00:00, 19685.03it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 3585/3585 [00:00&lt;00:00, 57240.78it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 2360/2360 [00:00&lt;00:00, 41612.96it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 2360/2360 [00:00&lt;00:00, 28141.85it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 3561/3561 [00:00&lt;00:00, 25893.68it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 2350/2350 [00:00&lt;00:00, 533251.16it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 3560/3560 [00:00&lt;00:00, 413861.87it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 2350/2350 [00:00&lt;00:00, 24410.49it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 3560/3560 [00:00&lt;00:00, 50944.30it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 2350/2350 [00:00&lt;00:00, 55926.91it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 2350/2350 [00:00&lt;00:00, 34726.81it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 3553/3553 [00:00&lt;00:00, 76546.81it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 2348/2348 [00:00&lt;00:00, 455830.86it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 3551/3551 [00:00&lt;00:00, 225372.60it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 2346/2346 [00:01&lt;00:00, 1800.82it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 3863/3863 [00:00&lt;00:00, 11449.89it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 2346/2346 [00:00&lt;00:00, 24471.91it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 2346/2346 [00:00&lt;00:00, 3424.32it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 2913/2913 [00:00&lt;00:00, 28242.28it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 1926/1926 [00:00&lt;00:00, 39995.00it/s]\nINFO:cityseer.tools.graphs:Ironing edges.\n100%|██████████| 2754/2754 [00:00&lt;00:00, 4255.90it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 1.\n100%|██████████| 2754/2754 [00:00&lt;00:00, 19277.37it/s]\n\n\nThe automated graph cleaning may give satisfactory results depending on the intended end-use. See the steps following beneath for an example of how to manually clean the graph where additional control is preferred.\n\nprint(\"The graph before simplification.\")\nsimple_plot(G_raw, plot_geoms=True)\n\nprint(\"The graph after simplification\")\nsimple_plot(G_utm, plot_geoms=True)\n\nINFO:cityseer.tools.plot:Preparing graph nodes\nINFO:cityseer.tools.plot:Preparing graph edges\n\n\nThe graph before simplification.\n\n\n100%|██████████| 5705/5705 [00:00&lt;00:00, 15899.38it/s]\n\n\n\n\n\n\n\n\n\nINFO:cityseer.tools.plot:Preparing graph nodes\nINFO:cityseer.tools.plot:Preparing graph edges\n\n\nThe graph after simplification\n\n\n100%|██████████| 2754/2754 [00:00&lt;00:00, 15020.47it/s]",
    "crumbs": [
      "Preparation",
      "Graph Cleaning"
    ]
  },
  {
    "objectID": "examples/graph_cleaning.html#manual-cleaning",
    "href": "examples/graph_cleaning.html#manual-cleaning",
    "title": "Graph Cleaning",
    "section": "Manual cleaning",
    "text": "Manual cleaning\nThe automated simplification uses a number of steps and should generally give a solid starting point for further manual cleaning.\nIt is also possible to clean the network with an entirely manual sequence of steps if you need greater control. The following is a basic example with the tools.graphs module.\n\nThe io.osm_graph_from_poly convenience method used for this demonstration has already converted the graph from a geographic WGS to projected UTM coordinate system; however, if working with a graph which is otherwise in a WGS coordinate system then it must be converted to a projected coordinate system prior to further processing. This can be done with io.nx_wgs_to_utm.\n\n\n# remove dangling nodes: short dead-end stubs\n# these are often found at entrances to buildings or parking lots\n# The removed_disconnected flag will removed isolated network components\n# i.e. disconnected portions of network that are not joined to the main street network\nG = graphs.nx_remove_dangling_nodes(G_raw)\nsimple_plot(G)\n\nINFO:cityseer.tools.graphs:Removing dangling nodes.\n100%|██████████| 4170/4170 [00:00&lt;00:00, 194706.03it/s]\nINFO:cityseer.tools.plot:Preparing graph nodes\nINFO:cityseer.tools.plot:Preparing graph edges\n100%|██████████| 4742/4742 [00:00&lt;00:00, 16334.55it/s]",
    "crumbs": [
      "Preparation",
      "Graph Cleaning"
    ]
  },
  {
    "objectID": "examples/graph_cleaning.html#refining-the-network",
    "href": "examples/graph_cleaning.html#refining-the-network",
    "title": "Graph Cleaning",
    "section": "Refining the network",
    "text": "Refining the network\nThings are already looked much better, but we still have areas with large concentrations of nodes at complex intersections and many parallel roadways, which will confound centrality methods. We’ll now try to remove as much of this as possible. These steps involve the consolidation of nodes to clean-up extraneous nodes, which may otherwise exaggerate the intensity or complexity of the network in certain situations.\nMerging parallel roadways: graphs.nx_split_opposing_geoms is used to intentionally split edges in near proximity to nodes located on an adjacent parallel roadway.\n\nG1 = graphs.nx_split_opposing_geoms(\n    G,\n    buffer_dist=30,\n    prioritise_by_hwy_tag=True,\n    osm_hwy_target_tags=[\"trunk\", \"primary\", \"secondary\", \"tertiary\"],\n    osm_matched_tags_only=True,\n    contains_buffer_dist=40,\n)\nsimple_plot(G1, plot_geoms=True)\n\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 4742/4742 [00:00&lt;00:00, 404190.16it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 3354/3354 [00:01&lt;00:00, 3052.71it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 40.\n100%|██████████| 4919/4919 [00:00&lt;00:00, 39594.95it/s]\nINFO:cityseer.tools.plot:Preparing graph nodes\nINFO:cityseer.tools.plot:Preparing graph edges\n100%|██████████| 4803/4803 [00:00&lt;00:00, 21649.77it/s]\n\n\n\n\n\n\n\n\n\nConsolidating nodes: Cleanup of intersections will be performed with the graphs.nx_consolidate_nodes function. The arguments passed to the parameters allow for a number of different strategies, such as whether to ‘crawl’; whether to use intersection through routes for determining new centroids; and to set the direct or indirect neighbour policies according to which nodes and edges are consolidated. These are explained more fully in the documentation.\n\nG2 = graphs.nx_consolidate_nodes(\n    G1,\n    buffer_dist=12,\n    crawl=True,\n    prioritise_by_hwy_tag=True,\n)\nsimple_plot(G2, plot_geoms=True)\n\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 3354/3354 [00:00&lt;00:00, 65556.46it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 3354/3354 [00:01&lt;00:00, 2448.76it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 3171/3171 [00:00&lt;00:00, 20202.23it/s]\nINFO:cityseer.tools.plot:Preparing graph nodes\nINFO:cityseer.tools.plot:Preparing graph edges\n100%|██████████| 3009/3009 [00:00&lt;00:00, 23708.96it/s]\n\n\n\n\n\n\n\n\n\nFinally, the edges are “ironed” to straighten out artefacts introduced by automated cleaning, which will sometimes bend the ends of edge segments to the locations of new centroids.\n\nG3 = graphs.nx_remove_filler_nodes(G2)\nG4 = graphs.nx_iron_edges(G3)\nsimple_plot(G4, plot_geoms=True)\n\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 2059/2059 [00:00&lt;00:00, 28881.64it/s]\nINFO:cityseer.tools.graphs:Ironing edges.\n100%|██████████| 2796/2796 [00:00&lt;00:00, 5151.34it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 1.\n100%|██████████| 2796/2796 [00:00&lt;00:00, 166103.99it/s]\nINFO:cityseer.tools.plot:Preparing graph nodes\nINFO:cityseer.tools.plot:Preparing graph edges\n100%|██████████| 2790/2790 [00:00&lt;00:00, 29996.48it/s]",
    "crumbs": [
      "Preparation",
      "Graph Cleaning"
    ]
  },
  {
    "objectID": "examples/london_centralities.html",
    "href": "examples/london_centralities.html",
    "title": "London Centralities",
    "section": "",
    "text": "Install and update cityseer if necessary.\n# !pip install --upgrade cityseer",
    "crumbs": [
      "Networks",
      "London Centralities"
    ]
  },
  {
    "objectID": "examples/london_centralities.html#data-source",
    "href": "examples/london_centralities.html#data-source",
    "title": "London Centralities",
    "section": "Data Source",
    "text": "Data Source\nThe following example uses the OS Open Roads dataset, which is available under the Open Government License.",
    "crumbs": [
      "Networks",
      "London Centralities"
    ]
  },
  {
    "objectID": "examples/london_centralities.html#preparation",
    "href": "examples/london_centralities.html#preparation",
    "title": "London Centralities",
    "section": "Preparation",
    "text": "Preparation\nThe following example assumes that the OS Open Roads dataset has been downloaded to temp/os_open_roads/oproad_gb.gpkg relative to the root of the cityseer-examples repository. Please edit the paths and path setup in this cell if you are using different directories.\n\nfrom pathlib import Path\n\nrepo_path = Path.cwd()\nif str(repo_path).endswith(\"examples\"):\n    repo_path = Path.cwd() / \"..\"\nif not str(repo_path.resolve()).endswith(\"cityseer-examples\"):\n    raise ValueError(\n        \"Please check your notebook working directory relative to your project and data paths.\"\n    )\n\nopen_roads_path = Path(repo_path / \"temp/os_open_roads/oproad_gb.gpkg\")\nprint(\"data path:\", open_roads_path)\nprint(\"path exists:\", open_roads_path.exists())\n\ndata path: /Users/gareth/dev/benchmark-urbanism/cityseer-examples/examples/../temp/os_open_roads/oproad_gb.gpkg\npath exists: True",
    "crumbs": [
      "Networks",
      "London Centralities"
    ]
  },
  {
    "objectID": "examples/london_centralities.html#extents",
    "href": "examples/london_centralities.html#extents",
    "title": "London Centralities",
    "section": "Extents",
    "text": "Extents\nInstead of loading the entire dataset, we’ll use a bounding box to only load an area of interest.\n\nfrom pyproj import Transformer\nfrom shapely import geometry\n\nfrom cityseer.tools import graphs, io\n\n# bbox setup\nlng, lat = -0.13396079424572427, 51.51371088849723\nbuffer_dist = 5000\ndistances = [250, 500, 1000, 2000]\nplot_buffer = 1500\n# transform from WGS to BNG\ntransformer = Transformer.from_crs(\"EPSG:4326\", \"EPSG:27700\")\neasting, northing = transformer.transform(lat, lng)\n# calculate bbox relative to centroid\ncentroid = geometry.Point(easting, northing)\ntarget_bbox: tuple[float, float, float, float] = centroid.buffer(buffer_dist).bounds  # type: ignore\nplot_bbox: tuple[float, float, float, float] = centroid.buffer(plot_buffer).bounds  # type: ignore",
    "crumbs": [
      "Networks",
      "London Centralities"
    ]
  },
  {
    "objectID": "examples/london_centralities.html#load",
    "href": "examples/london_centralities.html#load",
    "title": "London Centralities",
    "section": "Load",
    "text": "Load\nWe can now load the OS Open Roads dataset and convert it to a format that can be used by cityseer for downstream calculations.\n\n# load OS Open Roads data from downloaded geopackage\nG_open = io.nx_from_open_roads(open_roads_path, target_bbox=target_bbox)\n# decompose for higher resolution analysis\nG_decomp = graphs.nx_decompose(G_open, 25)\n# prepare the data structures\nnodes_gdf, _edges_gdf, network_structure = io.network_structure_from_nx(\n    G_decomp, crs=27700\n)\n\nINFO:cityseer.tools.io:Nodes: 18193\nINFO:cityseer.tools.io:Edges: 24189\nINFO:cityseer.tools.io:Dropped 430 edges where not both start and end nodes were present.\nINFO:cityseer.tools.io:Running basic graph cleaning\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 18193/18193 [00:00&lt;00:00, 36376.39it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 10.\n100%|██████████| 22578/22578 [00:00&lt;00:00, 125918.80it/s]\nINFO:cityseer.tools.graphs:Decomposing graph to maximum edge lengths of 25.\n100%|██████████| 22516/22516 [00:13&lt;00:00, 1718.67it/s]\nINFO:cityseer.tools.io:Preparing node and edge arrays from networkX graph.\n100%|██████████| 75794/75794 [00:00&lt;00:00, 77741.04it/s]\n100%|██████████| 75794/75794 [00:11&lt;00:00, 6857.38it/s]",
    "crumbs": [
      "Networks",
      "London Centralities"
    ]
  },
  {
    "objectID": "examples/london_centralities.html#calculate-centralities",
    "href": "examples/london_centralities.html#calculate-centralities",
    "title": "London Centralities",
    "section": "Calculate centralities",
    "text": "Calculate centralities\nThe centrality methods can now be computed.\n\nfrom cityseer.metrics import networks\n\n# if you want to compute wider area centralities, e.g. 20km, then use less decomposition to speed up the computation\nnodes_gdf = networks.node_centrality_shortest(\n    network_structure=network_structure,\n    nodes_gdf=nodes_gdf,\n    distances=distances,\n)\nnodes_gdf_jitter = nodes_gdf.copy(deep=True)\nnodes_gdf_jitter = networks.node_centrality_shortest(\n    network_structure=network_structure,\n    nodes_gdf=nodes_gdf_jitter,\n    distances=distances,\n    jitter_scale=10,\n)\nnodes_gdf = networks.node_centrality_simplest(\n    network_structure=network_structure,\n    nodes_gdf=nodes_gdf,\n    distances=distances,\n)\n\nINFO:cityseer.metrics.networks:Computing shortest path node centrality.\n100%|██████████| 75794/75794 [03:18&lt;00:00, 381.59it/s]\nINFO:cityseer.metrics.networks:Computing shortest path node centrality.\n100%|██████████| 75794/75794 [01:55&lt;00:00, 657.37it/s]\nINFO:cityseer.metrics.networks:Computing simplest path node centrality.\n100%|██████████| 75794/75794 [01:42&lt;00:00, 738.44it/s]",
    "crumbs": [
      "Networks",
      "London Centralities"
    ]
  },
  {
    "objectID": "examples/london_centralities.html#plots",
    "href": "examples/london_centralities.html#plots",
    "title": "London Centralities",
    "section": "Plots",
    "text": "Plots\nLet’s plot a selection of distance thresholds for each of the computed measures.\n\nimport matplotlib.pyplot as plt\nfrom cityseer import rustalgos\nfrom cityseer.tools import plot\n\nbg_colour = \"#111\"\nbetas = rustalgos.betas_from_distances(distances)\navg_dists = rustalgos.avg_distances_for_betas(betas)\nbg_colour = \"#111\"\ntext_colour = \"#ddd\"\nfont_size = 5\nfor d, b, avg_d in zip(distances, betas, avg_dists):\n    fig, axes = plt.subplots(1, 3, figsize=(8, 4), dpi=200, facecolor=bg_colour)\n    fig.suptitle(\n        f\"Shortest and simplest path closeness centrality: {d}m\",\n        fontsize=8,\n        color=text_colour,\n    )\n    plot.plot_scatter(\n        axes[0],\n        network_structure.node_xs,\n        network_structure.node_ys,\n        nodes_gdf[f\"cc_beta_{d}\"],\n        bbox_extents=plot_bbox,\n        cmap_key=\"magma\",\n        face_colour=bg_colour,\n    )\n    axes[0].set_title(\n        f\"Gravity index ({avg_d:.2f}m avg. toler.)\",\n        fontsize=font_size,\n        color=text_colour,\n    )\n    plot.plot_scatter(\n        axes[1],\n        network_structure.node_xs,\n        network_structure.node_ys,\n        nodes_gdf_jitter[f\"cc_beta_{d}\"],\n        bbox_extents=plot_bbox,\n        cmap_key=\"magma\",\n        face_colour=bg_colour,\n    )\n    axes[1].set_title(f\"Gravity index w. jitter\", fontsize=font_size, color=text_colour)\n    plot.plot_scatter(\n        axes[2],\n        network_structure.node_xs,\n        network_structure.node_ys,\n        nodes_gdf[f\"cc_hillier_{d}_ang\"],\n        bbox_extents=plot_bbox,\n        cmap_key=\"magma\",\n        face_colour=bg_colour,\n    )\n    axes[2].set_title(\n        f\"Simplest path hillier integration\", fontsize=font_size, color=text_colour\n    )\n    plt.tight_layout()\n    plt.show()\n\nfor d, b, avg_d in zip(distances, betas, avg_dists):\n    fig, axes = plt.subplots(1, 3, figsize=(8, 4), dpi=200, facecolor=bg_colour)\n    fig.suptitle(\n        f\"Shortest and simplest path betweenness centrality: {d}m\",\n        fontsize=8,\n        color=text_colour,\n    )\n    plot.plot_scatter(\n        axes[0],\n        network_structure.node_xs,\n        network_structure.node_ys,\n        nodes_gdf[f\"cc_betweenness_{d}\"],\n        bbox_extents=plot_bbox,\n        cmap_key=\"magma\",\n        s_max=2,\n        face_colour=bg_colour,\n    )\n    axes[0].set_title(\n        f\"Dist. wtd. betw. ({avg_d:.2f}m avg. toler.)\",\n        fontsize=font_size,\n        color=text_colour,\n    )\n    plot.plot_scatter(\n        axes[1],\n        network_structure.node_xs,\n        network_structure.node_ys,\n        nodes_gdf_jitter[f\"cc_betweenness_{d}\"],\n        bbox_extents=plot_bbox,\n        cmap_key=\"magma\",\n        s_max=2,\n        face_colour=bg_colour,\n    )\n    axes[1].set_title(\n        f\"Dist. wtd. betw. w. jitter\", fontsize=font_size, color=text_colour\n    )\n    plot.plot_scatter(\n        axes[2],\n        network_structure.node_xs,\n        network_structure.node_ys,\n        nodes_gdf[f\"cc_betweenness_{d}_ang\"],\n        bbox_extents=plot_bbox,\n        cmap_key=\"magma\",\n        s_max=2,\n        face_colour=bg_colour,\n    )\n    axes[2].set_title(\n        f\"Simplest path betweenness\", fontsize=font_size, color=text_colour\n    )\n    plt.tight_layout()\n    plt.show()",
    "crumbs": [
      "Networks",
      "London Centralities"
    ]
  },
  {
    "objectID": "examples/continuity/continuity_osm.html",
    "href": "examples/continuity/continuity_osm.html",
    "title": "OSM",
    "section": "",
    "text": "Set the coordinates and buffer distances to your preferred extents.\n\nfrom cityseer.tools import io\n\n# lng, lat, buffer_dist, plot_buffer = -1.7063649924889566, 52.19277374082795, 1500, 1250  # stratford-upon-avon\nlng, lat, buffer_dist, plot_buffer = (\n    -0.13039709427587876,\n    51.516434828344366,\n    6000,\n    5000,\n)  # london\n# lng, lat, buffer_dist, plot_buffer = 18.425702641104582, -33.9204746754594, 3000, 2500  # cape town\npoly_wgs, _ = io.buffered_point_poly(lng, lat, buffer_dist)\npoly_utm, _ = io.buffered_point_poly(lng, lat, buffer_dist, projected=True)\n# select extents for plotting\nplot_bbox = poly_utm.centroid.buffer(plot_buffer).bounds",
    "crumbs": [
      "Continuity",
      "OSM"
    ]
  },
  {
    "objectID": "examples/continuity/continuity_osm.html#preparation",
    "href": "examples/continuity/continuity_osm.html#preparation",
    "title": "OSM",
    "section": "",
    "text": "Set the coordinates and buffer distances to your preferred extents.\n\nfrom cityseer.tools import io\n\n# lng, lat, buffer_dist, plot_buffer = -1.7063649924889566, 52.19277374082795, 1500, 1250  # stratford-upon-avon\nlng, lat, buffer_dist, plot_buffer = (\n    -0.13039709427587876,\n    51.516434828344366,\n    6000,\n    5000,\n)  # london\n# lng, lat, buffer_dist, plot_buffer = 18.425702641104582, -33.9204746754594, 3000, 2500  # cape town\npoly_wgs, _ = io.buffered_point_poly(lng, lat, buffer_dist)\npoly_utm, _ = io.buffered_point_poly(lng, lat, buffer_dist, projected=True)\n# select extents for plotting\nplot_bbox = poly_utm.centroid.buffer(plot_buffer).bounds",
    "crumbs": [
      "Continuity",
      "OSM"
    ]
  },
  {
    "objectID": "examples/continuity/continuity_osm.html#loading-data-from-osm",
    "href": "examples/continuity/continuity_osm.html#loading-data-from-osm",
    "title": "OSM",
    "section": "Loading data from OSM",
    "text": "Loading data from OSM\nFor this example, we’ll use a custom OSM query that excludes footways because the continuity analysis needs OSM ways that have street name or route number information.\nFor this form of analysis, only basic cleaning is recommended:\n\nnot consolidating nodes because this risks accidentally dropping highway / ref / name attributes\nnot like closeness or betweenness methods, where topological distortions are arguably a bigger issue\n\n\nquery = \"\"\"\n[out:json];\n(\n    way[\"highway\"]\n    [\"area\"!=\"yes\"]\n    [\"highway\"!~\"footway|pedestrian|steps|bus_guideway|escape|raceway|proposed|planned|abandoned|platform|construction\"]\n    [\"service\"!~\"parking_aisle\"]\n    [\"amenity\"!~\"charging_station|parking|fuel|motorcycle_parking|parking_entrance|parking_space\"]\n    [\"access\"!~\"private|customers\"]\n    [\"indoor\"!=\"yes\"]\n    (poly:\"{geom_osm}\");\n);\nout body;\n&gt;;\nout qt;\n\"\"\"\nG_osm = io.osm_graph_from_poly(\n    poly_wgs, custom_request=query, simplify=True, iron_edges=False\n)\n\nINFO:cityseer.tools.io:Converting networkX graph from EPSG code 4326 to EPSG code 32630.\nINFO:cityseer.tools.io:Processing node x, y coordinates.\n100%|██████████| 141799/141799 [00:00&lt;00:00, 307109.58it/s]\nINFO:cityseer.tools.io:Processing edge geom coordinates, if present.\n100%|██████████| 152077/152077 [00:00&lt;00:00, 672708.16it/s]\nINFO:cityseer.tools.graphs:Generating interpolated edge geometries.\n100%|██████████| 152077/152077 [00:03&lt;00:00, 47701.10it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 141799/141799 [00:23&lt;00:00, 6088.50it/s]\nINFO:cityseer.tools.graphs:Removing dangling nodes.\n100%|██████████| 36411/36411 [00:00&lt;00:00, 226888.05it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 34012/34012 [00:00&lt;00:00, 56288.52it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 32172/32172 [00:00&lt;00:00, 87738.65it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 32172/32172 [00:08&lt;00:00, 3622.80it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 26632/26632 [00:00&lt;00:00, 184209.95it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 50.\n100%|██████████| 36520/36520 [00:03&lt;00:00, 10934.54it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 34380/34380 [00:00&lt;00:00, 529406.13it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 26335/26335 [00:09&lt;00:00, 2859.41it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 50.\n100%|██████████| 35324/35324 [00:00&lt;00:00, 149166.62it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 27279/27279 [00:00&lt;00:00, 97660.35it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 27279/27279 [00:04&lt;00:00, 6087.78it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 24920/24920 [00:00&lt;00:00, 58761.52it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 50.\n100%|██████████| 32513/32513 [00:01&lt;00:00, 20982.18it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 23585/23585 [00:00&lt;00:00, 141766.68it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 30677/30677 [00:00&lt;00:00, 700146.18it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 23133/23133 [00:05&lt;00:00, 4191.83it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 50.\n100%|██████████| 30750/30750 [00:00&lt;00:00, 43371.19it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 23206/23206 [00:00&lt;00:00, 119011.86it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 23206/23206 [00:01&lt;00:00, 12658.30it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 23083/23083 [00:00&lt;00:00, 621311.58it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 50.\n100%|██████████| 30654/30654 [00:00&lt;00:00, 131804.30it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 23066/23066 [00:00&lt;00:00, 503339.17it/s]",
    "crumbs": [
      "Continuity",
      "OSM"
    ]
  },
  {
    "objectID": "examples/continuity/continuity_osm.html#observe-continuity-metrics",
    "href": "examples/continuity/continuity_osm.html#observe-continuity-metrics",
    "title": "OSM",
    "section": "Observe continuity metrics",
    "text": "Observe continuity metrics\nWe can now run the contunity metrics\n\nimport matplotlib.pyplot as plt\n\nfrom cityseer.tools import io, plot\nfrom cityseer.metrics import observe\n\n# methods can be \"names\", \"routes\", \"highways\"\n\nprint(\"Continuity by street names\")\nG_cont, NamesContReport = observe.street_continuity(G_osm, method=\"names\")\nNamesContReport.report_by_count(n_items=5)\nNamesContReport.report_by_length(n_items=5)\n\nprint(\"Continuity by route numbers\")\nG_cont, RoutesContReport = observe.street_continuity(G_cont, method=\"routes\")\nRoutesContReport.report_by_count(n_items=5)\nRoutesContReport.report_by_length(n_items=5)\n\nprint(\"Continuity by highway types\")\nG_cont, HwyContReport = observe.street_continuity(G_cont, method=\"highways\")\nHwyContReport.report_by_count(n_items=5)\nHwyContReport.report_by_length(n_items=5)\n\nprint(\"Continuity by overlapping routes and names types\")\nG_cont, HybridContReport = observe.hybrid_street_continuity(G_cont)\nHybridContReport.report_by_count(n_items=5)\nHybridContReport.report_by_length(n_items=5)\n\nINFO:cityseer.metrics.observe:Calculating metrics for names.\n\n\nContinuity by street names\n\n\n100%|██████████| 30519/30519 [00:00&lt;00:00, 44680.14it/s]\nINFO:cityseer.metrics.observe:Reporting top 5 continuity observations by street counts.\nINFO:cityseer.metrics.observe:Count: 52 - harrow road\nINFO:cityseer.metrics.observe:Count: 50 - holloway road\nINFO:cityseer.metrics.observe:Count: 48 - king's road\nINFO:cityseer.metrics.observe:Count: 46 - wandsworth road\nINFO:cityseer.metrics.observe:Count: 44 - battersea park road\nINFO:cityseer.metrics.observe:Reporting top 5 continuity observations by street lengths.\nINFO:cityseer.metrics.observe:Length: 6.0km - westway\nINFO:cityseer.metrics.observe:Length: 5.02km - regent's canal towpath\nINFO:cityseer.metrics.observe:Length: 4.43km - outer circle\nINFO:cityseer.metrics.observe:Length: 3.95km - harrow road\nINFO:cityseer.metrics.observe:Length: 3.35km - finchley road\nINFO:cityseer.metrics.observe:Calculating metrics for routes.\n\n\nContinuity by route numbers\n\n\n100%|██████████| 30519/30519 [00:00&lt;00:00, 172552.22it/s]\nINFO:cityseer.metrics.observe:Reporting top 5 continuity observations by street counts.\nINFO:cityseer.metrics.observe:Count: 174 - a4\nINFO:cityseer.metrics.observe:Count: 151 - a3220\nINFO:cityseer.metrics.observe:Count: 144 - a501\nINFO:cityseer.metrics.observe:Count: 107 - a400\nINFO:cityseer.metrics.observe:Count: 99 - a202\nINFO:cityseer.metrics.observe:Reporting top 5 continuity observations by street lengths.\nINFO:cityseer.metrics.observe:Length: 12.6km - a4\nINFO:cityseer.metrics.observe:Length: 10.95km - a3220\nINFO:cityseer.metrics.observe:Length: 9.0km - a501\nINFO:cityseer.metrics.observe:Length: 7.94km - a400\nINFO:cityseer.metrics.observe:Length: 7.71km - a202\n\n\nContinuity by highway types\n\n\nINFO:cityseer.metrics.observe:Calculating metrics for highways.\n100%|██████████| 30519/30519 [00:00&lt;00:00, 87953.52it/s]\nINFO:cityseer.metrics.observe:Reporting top 5 continuity observations by street counts.\nINFO:cityseer.metrics.observe:Count: 13294 - residential\nINFO:cityseer.metrics.observe:Count: 6573 - service\nINFO:cityseer.metrics.observe:Count: 3200 - unclassified\nINFO:cityseer.metrics.observe:Count: 2650 - primary\nINFO:cityseer.metrics.observe:Count: 1963 - cycleway\nINFO:cityseer.metrics.observe:Reporting top 5 continuity observations by street lengths.\nINFO:cityseer.metrics.observe:Length: 1045.4km - residential\nINFO:cityseer.metrics.observe:Length: 428.53km - service\nINFO:cityseer.metrics.observe:Length: 243.57km - unclassified\nINFO:cityseer.metrics.observe:Length: 181.72km - primary\nINFO:cityseer.metrics.observe:Length: 167.71km - cycleway\n\n\nContinuity by overlapping routes and names types\n\n\nINFO:cityseer.metrics.observe:Calculating metrics for routes.\n100%|██████████| 30519/30519 [00:00&lt;00:00, 140316.03it/s]\nINFO:cityseer.metrics.observe:Reporting top 5 continuity observations by street counts.\nINFO:cityseer.metrics.observe:Count: 304 - a501\nINFO:cityseer.metrics.observe:Count: 281 - a202\nINFO:cityseer.metrics.observe:Count: 280 - a3220\nINFO:cityseer.metrics.observe:Count: 255 - a4\nINFO:cityseer.metrics.observe:Count: 170 - a400\nINFO:cityseer.metrics.observe:Reporting top 5 continuity observations by street lengths.\nINFO:cityseer.metrics.observe:Length: 22.66km - a501\nINFO:cityseer.metrics.observe:Length: 21.08km - a3220\nINFO:cityseer.metrics.observe:Length: 19.9km - a202\nINFO:cityseer.metrics.observe:Length: 19.06km - a4\nINFO:cityseer.metrics.observe:Length: 13.35km - a40\n\n\n\nfor method, shape_exp, descriptor, cmap, inverse, col_by_categ in zip(\n    [\"names\", \"routes\", \"highways\", \"hybrid\"],  #\n    [1, 0.75, 0.5, 1],  #\n    [\"Street names\", \"Routes\", \"Road types\", \"Hybrid routes & names\"],  #\n    [\"plasma\", \"viridis\", \"tab10\", \"tab10\"],  #\n    [False, False, True, False],  #\n    [False, False, True, True],\n):\n    print(f\"Plotting results for method: {method}\")\n    # plot\n    bg_colour = \"#111\"\n    fig, axes = plt.subplots(\n        2, 1, dpi=150, figsize=(8, 12), facecolor=bg_colour, constrained_layout=True\n    )\n    fig.suptitle(\n        f\"OS Open Roads plotted by {descriptor} continuity\",\n        fontsize=\"small\",\n        ha=\"center\",\n    )\n    # by count\n    plot.plot_nx_edges(\n        axes[0],  # type: ignore\n        nx_multigraph=G_cont,\n        edge_metrics_key=f\"{method}_cont_by_count\",\n        bbox_extents=plot_bbox,\n        cmap_key=cmap,\n        lw_min=0.5,\n        lw_max=2,\n        edge_label_key=f\"{method}_cont_by_label\",\n        colour_by_categorical=col_by_categ,\n        shape_exp=shape_exp,\n        face_colour=bg_colour,\n        invert_plot_order=inverse,\n    )\n    axes[0].set_xlabel(f\"{descriptor} by count\", fontsize=\"x-small\")  # type: ignore\n    # by length\n    plot.plot_nx_edges(\n        axes[1],  # type: ignore\n        nx_multigraph=G_cont,\n        edge_metrics_key=f\"{method}_cont_by_length\",\n        bbox_extents=plot_bbox,\n        cmap_key=cmap,\n        lw_min=0.5,\n        lw_max=2,\n        edge_label_key=f\"{method}_cont_by_label\",\n        colour_by_categorical=col_by_categ,\n        shape_exp=shape_exp,\n        face_colour=bg_colour,\n        invert_plot_order=inverse,\n    )\n    axes[1].set_xlabel(f\"{descriptor} by length (metres)\", fontsize=\"x-small\")  # type: ignore\n    plt.show()\n\nINFO:cityseer.tools.plot:Extracting edge geometries\n\n\nPlotting results for method: names\n\n\n30519it [00:00, 436173.32it/s]\nINFO:cityseer.tools.plot:Generating plot\n100%|██████████| 30519/30519 [00:03&lt;00:00, 9848.79it/s] \nINFO:cityseer.tools.plot:Extracting edge geometries\n30519it [00:00, 515888.89it/s]\nINFO:cityseer.tools.plot:Generating plot\n100%|██████████| 30519/30519 [00:02&lt;00:00, 11225.09it/s]\n\n\n\n\n\n\n\n\n\nINFO:cityseer.tools.plot:Extracting edge geometries\n\n\nPlotting results for method: routes\n\n\n30519it [00:00, 639530.98it/s]\nINFO:cityseer.tools.plot:Generating plot\n100%|██████████| 30519/30519 [00:02&lt;00:00, 10577.33it/s]\nINFO:cityseer.tools.plot:Extracting edge geometries\n30519it [00:00, 623780.34it/s]\nINFO:cityseer.tools.plot:Generating plot\n100%|██████████| 30519/30519 [00:02&lt;00:00, 10582.54it/s]\n\n\n\n\n\n\n\n\n\nINFO:cityseer.tools.plot:Extracting edge geometries\n\n\nPlotting results for method: highways\n\n\n30519it [00:00, 583939.51it/s]\nINFO:cityseer.tools.plot:Generating plot\n100%|██████████| 11/11 [00:02&lt;00:00,  5.28it/s]\nINFO:cityseer.tools.plot:Extracting edge geometries\n30519it [00:00, 538861.30it/s]\nINFO:cityseer.tools.plot:Generating plot\n100%|██████████| 11/11 [00:01&lt;00:00,  5.67it/s]\n\n\n\n\n\n\n\n\n\nINFO:cityseer.tools.plot:Extracting edge geometries\n\n\nPlotting results for method: hybrid\n\n\n30519it [00:00, 632900.20it/s]\nINFO:cityseer.tools.plot:Generating plot\n100%|██████████| 11/11 [00:01&lt;00:00,  6.20it/s]\nINFO:cityseer.tools.plot:Extracting edge geometries\n30519it [00:00, 686204.52it/s]\nINFO:cityseer.tools.plot:Generating plot\n100%|██████████| 11/11 [00:01&lt;00:00,  7.26it/s]",
    "crumbs": [
      "Continuity",
      "OSM"
    ]
  },
  {
    "objectID": "examples/momepy_to_cityseer.html",
    "href": "examples/momepy_to_cityseer.html",
    "title": "momepy - cityseer",
    "section": "",
    "text": "from future import annotations\nimport geopandas as gpd from osmnx import features\nfrom cityseer.tools import io, graphs from cityseer.metrics import networks, layers\nThis example uses the momepy bubenec.gpkg GeoPandas GeoDataFrame as an example. Please download this file and place it in a locally accessible file. Update the filepaths in the next code block accordingly.\n\nfrom pathlib import Path\n\nimport geopandas as gpd\nfrom cityseer.tools import io, graphs\nfrom cityseer.metrics import networks, layers\nfrom osmnx import features\n\nrepo_path = Path.cwd()\nif str(repo_path).endswith(\"examples\"):\n    repo_path = Path.cwd() / \"..\"\nif not str(repo_path.resolve()).endswith(\"cityseer-examples\"):\n    raise ValueError(\n        \"Please check your notebook working directory relative to your project and data paths.\"\n    )\n\nbubenec_path = Path(repo_path / \"temp/bubenec.gpkg\")\nprint(\"data path:\", bubenec_path)\nprint(\"path exists:\", bubenec_path.exists())\n\ndf_streets: gpd.GeoDataFrame = gpd.read_file(bubenec_path, layer=\"streets\")  # type: ignore\nnx_momepy = io.nx_from_generic_geopandas(df_streets)\n\ndata path: /Users/gareth/dev/benchmark-urbanism/cityseer-examples/examples/../temp/bubenec.gpkg\npath exists: True\n\n\n100%|██████████| 35/35 [00:00&lt;00:00, 1769.83it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 1.\n100%|██████████| 35/35 [00:00&lt;00:00, 47187.61it/s]\n\n\nAt this point the input GeoPandas file has been converted to a networkX MultiGraph with geom attributes for the edges. This graph can now be fed to cityseer graph module methods if wanted. For running optimised network centrality or landuse accessibilities, use the io.network_structure_from_nx method to prepare the necessary structures.\n\nnodes_gdf, edges_gdf, network_structure = io.network_structure_from_nx(\n    nx_momepy, crs=df_streets.crs.to_epsg()\n)\n\nINFO:cityseer.tools.io:Preparing node and edge arrays from networkX graph.\n100%|██████████| 29/29 [00:00&lt;00:00, 14449.37it/s]\n100%|██████████| 29/29 [00:00&lt;00:00, 2098.13it/s]\n\n\nThe following block downloads some OSM data which will be used for demonstrating some landuse accessibility methods.\n\nnodes_gdf.head()\n\n\n\n\n\n\n\n\nns_node_idx\nx\ny\nlive\nweight\ngeom\n\n\n\n\nx1603585.6-y6464428.8\n0\n1603585.6\n6464428.8\nTrue\n1\nPOINT (1603585.6 6464428.8)\n\n\nx1603413.2-y6464228.7\n1\n1603413.2\n6464228.7\nTrue\n1\nPOINT (1603413.2 6464228.7)\n\n\nx1603268.5-y6464060.8\n2\n1603268.5\n6464060.8\nTrue\n1\nPOINT (1603268.5 6464060.8)\n\n\nx1603363.6-y6464031.9\n3\n1603363.6\n6464031.9\nTrue\n1\nPOINT (1603363.6 6464031.9)\n\n\nx1603607.3-y6464181.9\n4\n1603607.3\n6464181.9\nTrue\n1\nPOINT (1603607.3 6464181.9)\n\n\n\n\n\n\n\n\nedges_gdf.head(3)\n\n\n\n\n\n\n\n\nns_edge_idx\nstart_ns_node_idx\nend_ns_node_idx\nedge_idx\nnx_start_node_key\nnx_end_node_key\nlength\nangle_sum\nimp_factor\nin_bearing\nout_bearing\ntotal_bearing\ngeom\n\n\n\n\nx1603585.6-y6464428.8-x1603413.2-y6464228.7\n0\n0\n1\n0\nx1603585.6-y6464428.8\nx1603413.2-y6464228.7\n264.124535\n0.000000\n1\n-130.747175\n-130.747175\n-130.747175\nLINESTRING (1603585.6 6464428.8, 1603413.2 646...\n\n\nx1603585.6-y6464428.8-x1603561.7-y6464494.5\n1\n0\n8\n0\nx1603585.6-y6464428.8\nx1603561.7-y6464494.5\n70.026746\n8.479425\n1\n111.540976\n103.061551\n109.990108\nLINESTRING (1603561.7 6464494.5, 1603564.6 646...\n\n\nx1603585.6-y6464428.8-x1603650.5-y6464368.6\n2\n0\n6\n0\nx1603585.6-y6464428.8\nx1603650.5-y6464368.6\n88.999005\n19.087196\n1\n-42.077527\n-55.684912\n-42.848413\nLINESTRING (1603585.6 6464428.8, 1603603.1 646...\n\n\n\n\n\n\n\n\ndata_gdf = features.features_from_point(\n    (50.1029248, 14.4029967), tags={\"amenity\": [\"pub\", \"restaurant\"]}, dist=400\n)\ndata_gdf.to_crs(3857, inplace=True)\ndata_gdf = data_gdf.loc[\"node\"]\ndata_gdf = data_gdf.reset_index(level=0, drop=True)\ndata_gdf.index = data_gdf.index.astype(str)\ndata_gdf = data_gdf[[\"amenity\", \"geometry\"]]\nprint(data_gdf.head())\n\n      amenity                         geometry\n0  restaurant  POINT (1602992.986 6463522.177)\n1  restaurant  POINT (1602903.753 6463784.958)\n2  restaurant  POINT (1603489.527 6463552.391)\n3  restaurant  POINT (1602809.665 6464167.222)\n4  restaurant   POINT (1603027.863 6464060.66)\n\n\n\n# compute metrics\nnodes_gdf = networks.node_centrality_shortest(\n    network_structure, nodes_gdf, [250, 500, 1000]\n)\nnodes_gdf, data_gdf = layers.compute_accessibilities(\n    data_gdf,\n    landuse_column_label=\"amenity\",\n    accessibility_keys=[\"restaurant\"],\n    nodes_gdf=nodes_gdf,\n    network_structure=network_structure,\n    distances=[100, 200, 400],\n)\nnodes_gdf.head()\n\nINFO:cityseer.metrics.networks:Computing shortest path node centrality.\n100%|██████████| 29/29 [00:01&lt;00:00, 28.82it/s]\nINFO:cityseer.metrics.layers:Computing land-use accessibility for: restaurant\n100%|██████████| 29/29 [00:01&lt;00:00, 28.90it/s]\n\n\n\n\n\n\n\n\n\nns_node_idx\nx\ny\nlive\nweight\ngeom\ncc_beta_250\ncc_beta_500\ncc_beta_1000\ncc_cycles_250\n...\ncc_betweenness_beta_250\ncc_betweenness_beta_500\ncc_betweenness_beta_1000\ncc_restaurant_100_nw\ncc_restaurant_100_wt\ncc_restaurant_200_nw\ncc_restaurant_200_wt\ncc_restaurant_400_nw\ncc_restaurant_400_wt\ncc_restaurant_nearest_max_400\n\n\n\n\nx1603585.6-y6464428.8\n0\n1603585.6\n6464428.8\nTrue\n1\nPOINT (1603585.6 6464428.8)\n0.716430\n2.049671\n4.991226\n0.0\n...\n0.104906\n1.055928\n6.453668\n0.0\n0.000000\n0.0\n0.000000\n1.0\n0.043196\n314.199646\n\n\nx1603413.2-y6464228.7\n1\n1603413.2\n6464228.7\nTrue\n1\nPOINT (1603413.2 6464228.7)\n0.121621\n1.310057\n5.305830\n0.0\n...\n0.000000\n0.089919\n5.085167\n1.0\n0.134929\n1.0\n0.367327\n2.0\n0.660115\n50.075100\n\n\nx1603268.5-y6464060.8\n2\n1603268.5\n6464060.8\nTrue\n1\nPOINT (1603268.5 6464060.8)\n0.434258\n1.921060\n5.837248\n0.0\n...\n0.036046\n0.693404\n4.368770\n1.0\n0.309082\n1.0\n0.555951\n5.0\n0.895088\n29.353716\n\n\nx1603363.6-y6464031.9\n3\n1603363.6\n6464031.9\nTrue\n1\nPOINT (1603363.6 6464031.9)\n0.390539\n1.849684\n6.035850\n1.0\n...\n0.000000\n0.676799\n6.885900\n0.0\n0.000000\n1.0\n0.075555\n2.0\n0.354505\n129.144821\n\n\nx1603607.3-y6464181.9\n4\n1603607.3\n6464181.9\nTrue\n1\nPOINT (1603607.3 6464181.9)\n0.284575\n1.452098\n4.887502\n1.0\n...\n0.000000\n0.263222\n3.326343\n0.0\n0.000000\n0.0\n0.000000\n1.0\n0.082238\n249.814056\n\n\n\n\n5 rows × 37 columns\n\n\n\n\n# if using dual network\nnx_dual = graphs.nx_to_dual(nx_momepy)\nnodes_gdf_dual, _edges_gdf_dual, network_structure_dual = io.network_structure_from_nx(\n    nx_dual, df_streets.crs.to_epsg()\n)\nnodes_gdf_dual = networks.node_centrality_simplest(\n    network_structure_dual, nodes_gdf_dual, [500]\n)\nnodes_gdf_dual.head()\n\nINFO:cityseer.tools.graphs:Converting graph to dual.\nINFO:cityseer.tools.graphs:Preparing dual nodes\n100%|██████████| 35/35 [00:00&lt;00:00, 8260.22it/s]\nINFO:cityseer.tools.graphs:Preparing dual edges (splitting and welding geoms)\n100%|██████████| 35/35 [00:00&lt;00:00, 411.48it/s]\nINFO:cityseer.tools.io:Preparing node and edge arrays from networkX graph.\n100%|██████████| 35/35 [00:00&lt;00:00, 26374.53it/s]\n100%|██████████| 35/35 [00:00&lt;00:00, 1860.40it/s]\nINFO:cityseer.metrics.networks:Computing simplest path node centrality.\n100%|██████████| 35/35 [00:01&lt;00:00, 34.90it/s]\n\n\n\n\n\n\n\n\n\nns_node_idx\nx\ny\nlive\nweight\nprimal_edge\nprimal_edge_node_a\nprimal_edge_node_b\nprimal_edge_idx\ndual_node\ncc_density_500_ang\ncc_harmonic_500_ang\ncc_hillier_500_ang\ncc_farness_500_ang\ncc_betweenness_500_ang\n\n\n\n\nx1603413.2-y6464228.7_x1603585.6-y6464428.8_k0\n0\n1.603499e+06\n6.464329e+06\nTrue\n1\nLINESTRING (1603585.6 6464428.8, 1603413.2 646...\nx1603585.6-y6464428.8\nx1603413.2-y6464228.7\n0\nPOINT (1603499.4 6464328.75)\n18.0\n11.510646\n10.932516\n29.636362\n10.0\n\n\nx1603561.7-y6464494.5_x1603585.6-y6464428.8_k0\n1\n1.603573e+06\n6.464461e+06\nTrue\n1\nLINESTRING (1603561.7 6464494.5, 1603564.6 646...\nx1603585.6-y6464428.8\nx1603561.7-y6464494.5\n0\nPOINT (1603572.744261 6464461.367872)\n13.0\n8.309587\n7.957019\n21.239109\n11.0\n\n\nx1603585.6-y6464428.8_x1603650.5-y6464368.6_k0\n2\n1.603619e+06\n6.464400e+06\nTrue\n1\nLINESTRING (1603585.6 6464428.8, 1603603.1 646...\nx1603585.6-y6464428.8\nx1603650.5-y6464368.6\n0\nPOINT (1603619.281722 6464399.737661)\n13.0\n8.325413\n8.047424\n21.000507\n16.0\n\n\nx1603413.2-y6464228.7_x1603607.3-y6464181.9_k0\n3\n1.603510e+06\n6.464204e+06\nTrue\n1\nLINESTRING (1603607.3 6464181.9, 1603592.9 646...\nx1603413.2-y6464228.7\nx1603607.3-y6464181.9\n0\nPOINT (1603510.08598 6464204.473294)\n21.0\n13.297271\n12.853871\n34.308731\n10.0\n\n\nx1603363.6-y6464031.9_x1603413.2-y6464228.7_k0\n4\n1.603388e+06\n6.464130e+06\nTrue\n1\nLINESTRING (1603363.6 6464031.9, 1603376.5 646...\nx1603413.2-y6464228.7\nx1603363.6-y6464031.9\n0\nPOINT (1603388.006614 6464130.397742)\n24.0\n15.824812\n15.012451\n38.368153\n9.0",
    "crumbs": [
      "Conversion",
      "momepy - cityseer"
    ]
  },
  {
    "objectID": "examples/graph_corrections.html",
    "href": "examples/graph_corrections.html",
    "title": "OSM Strategies",
    "section": "",
    "text": "Install and update cityseer if necessary.\n\n# !pip install --upgrade cityseer\n\nSee the guide for a preamble.\nPlease also see the graph cleaning guide for additional information on the graph cleaning approach.\nThis notebook uses OSM data to compare three strategies for network preparation and then compares the centralities computed on each:\n\nAlgorithmically cleaning and consolidating the network\nUsing a minimally cleaned network which strips out unnecessary nodes but doesn’t apply any consolidation methods.\nUsing a minimally cleaned network but with corrections for network distortions through edge “dissolving” and “jitter”.\n\n\nPreparing the data extents\n\nimport matplotlib.pyplot as plt\nfrom cityseer import rustalgos\nfrom cityseer.metrics import networks\nfrom cityseer.tools import graphs, io, plot\n\n# download from OSM\nlng, lat = -0.13396079424572427, 51.51371088849723\nbuffer = 5000\ndistances = [250, 500, 1000, 2000]\n# creates a WGS shapely polygon\npoly_wgs, _ = io.buffered_point_poly(lng, lat, buffer)\npoly_utm, _ = io.buffered_point_poly(lng, lat, buffer, projected=True)\n\n\n\nAutomatic cleaning\nThis approach prepares a network using automated algorithmic cleaning methods to consolidate complex intersections and parallel roads.\n\nG_utm = io.osm_graph_from_poly(poly_wgs, simplify=True)\n# decompose for higher resolution analysis\nG_decomp = graphs.nx_decompose(G_utm, 25)\n# prepare data structures\nnodes_gdf, _edges_gdf, network_structure = io.network_structure_from_nx(\n    G_decomp, crs=32629\n)\n# compute centralities\n# if computing wider area centralities, e.g. 20km, then use less decomposition to speed up the computation\nnodes_gdf = networks.node_centrality_shortest(\n    network_structure=network_structure,\n    nodes_gdf=nodes_gdf,\n    distances=distances,\n)\n\nINFO:cityseer.tools.io:Converting networkX graph from EPSG code 4326 to EPSG code 32630.\nINFO:cityseer.tools.io:Processing node x, y coordinates.\n100%|██████████| 162040/162040 [00:00&lt;00:00, 438072.54it/s]\nINFO:cityseer.tools.io:Processing edge geom coordinates, if present.\n100%|██████████| 178697/178697 [00:00&lt;00:00, 896442.79it/s]\nINFO:cityseer.tools.graphs:Generating interpolated edge geometries.\n100%|██████████| 178697/178697 [00:02&lt;00:00, 68445.93it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 162040/162040 [00:25&lt;00:00, 6312.45it/s]\nINFO:cityseer.tools.graphs:Removing dangling nodes.\n100%|██████████| 51555/51555 [00:00&lt;00:00, 237584.81it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 44904/44904 [00:01&lt;00:00, 38113.22it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 58891/58891 [00:00&lt;00:00, 415163.92it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 41511/41511 [00:00&lt;00:00, 123098.74it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 30.\n100%|██████████| 58891/58891 [00:01&lt;00:00, 51264.88it/s] \nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 41511/41511 [00:00&lt;00:00, 94965.87it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 41511/41511 [00:00&lt;00:00, 158598.79it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 41511/41511 [00:00&lt;00:00, 509769.56it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 30.\n100%|██████████| 58891/58891 [00:01&lt;00:00, 53173.99it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 41511/41511 [00:00&lt;00:00, 614905.06it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 58891/58891 [00:00&lt;00:00, 235998.15it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 41511/41511 [00:02&lt;00:00, 19061.57it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 59469/59469 [00:01&lt;00:00, 55940.76it/s] \nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 41511/41511 [00:00&lt;00:00, 93647.37it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 41511/41511 [00:01&lt;00:00, 32368.36it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 40527/40527 [00:00&lt;00:00, 418696.88it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 57511/57511 [00:00&lt;00:00, 90752.74it/s] \nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 40446/40446 [00:00&lt;00:00, 204288.27it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 57406/57406 [00:00&lt;00:00, 680416.24it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 40419/40419 [00:03&lt;00:00, 11423.67it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 58169/58169 [00:01&lt;00:00, 54530.04it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 40419/40419 [00:00&lt;00:00, 75602.15it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 40419/40419 [00:02&lt;00:00, 17676.09it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 38792/38792 [00:00&lt;00:00, 363861.59it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 55202/55202 [00:01&lt;00:00, 49463.93it/s] \nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 38669/38669 [00:00&lt;00:00, 440843.86it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 55040/55040 [00:00&lt;00:00, 601741.44it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 38634/38634 [00:00&lt;00:00, 42098.44it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 55146/55146 [00:01&lt;00:00, 39349.30it/s] \nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 38634/38634 [00:00&lt;00:00, 79634.42it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 38634/38634 [00:00&lt;00:00, 39784.86it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 38199/38199 [00:00&lt;00:00, 519671.04it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 54485/54485 [00:01&lt;00:00, 47745.91it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 38170/38170 [00:00&lt;00:00, 495579.88it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 54456/54456 [00:00&lt;00:00, 668531.19it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 38163/38163 [00:01&lt;00:00, 28932.21it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 54617/54617 [00:00&lt;00:00, 75056.94it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 38163/38163 [00:00&lt;00:00, 104042.24it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 38163/38163 [00:01&lt;00:00, 32052.40it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 37484/37484 [00:00&lt;00:00, 507041.24it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 53538/53538 [00:00&lt;00:00, 117708.33it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 37437/37437 [00:00&lt;00:00, 502340.70it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 53496/53496 [00:00&lt;00:00, 722101.14it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 37427/37427 [00:03&lt;00:00, 10784.71it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 53796/53796 [00:00&lt;00:00, 85636.08it/s] \nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 37427/37427 [00:00&lt;00:00, 102697.57it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 37427/37427 [00:03&lt;00:00, 9863.52it/s] \nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 35323/35323 [00:00&lt;00:00, 344694.94it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 50945/50945 [00:00&lt;00:00, 106948.01it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 35172/35172 [00:00&lt;00:00, 586149.32it/s]\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 50886/50886 [00:00&lt;00:00, 731931.94it/s]\nINFO:cityseer.tools.graphs:Splitting opposing edges.\n100%|██████████| 35154/35154 [00:18&lt;00:00, 1902.97it/s]\nINFO:cityseer.tools.graphs:Squashing opposing nodes\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 57668/57668 [00:04&lt;00:00, 12880.58it/s]\nINFO:cityseer.tools.util:Creating nodes STR tree\n100%|██████████| 35154/35154 [00:00&lt;00:00, 97327.74it/s]\nINFO:cityseer.tools.graphs:Consolidating nodes.\n100%|██████████| 35154/35154 [00:05&lt;00:00, 6705.32it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 27353/27353 [00:00&lt;00:00, 76768.47it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 25.\n100%|██████████| 38972/38972 [00:01&lt;00:00, 32417.56it/s] \nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 26128/26128 [00:00&lt;00:00, 163624.19it/s]\nINFO:cityseer.tools.graphs:Ironing edges.\n100%|██████████| 37103/37103 [00:06&lt;00:00, 5314.87it/s]\nINFO:cityseer.tools.graphs:Merging parallel edges within buffer of 1.\n100%|██████████| 37103/37103 [00:00&lt;00:00, 42173.18it/s] \nINFO:cityseer.tools.graphs:Decomposing graph to maximum edge lengths of 25.\n100%|██████████| 37091/37091 [00:15&lt;00:00, 2320.62it/s]\nINFO:cityseer.tools.io:Preparing node and edge arrays from networkX graph.\n100%|██████████| 93414/93414 [00:00&lt;00:00, 109903.89it/s]\n100%|██████████| 93414/93414 [00:13&lt;00:00, 7095.40it/s]\nINFO:cityseer.metrics.networks:Computing shortest path node centrality.\n100%|██████████| 93414/93414 [04:53&lt;00:00, 318.51it/s]\n\n\n\n\nMinimal cleaning\nThis method performs minimal cleaning and is used for reference point for the other two methods.\n\n# generate OSM graph from polygon - note no automatic simplification applied\nG_utm_minimal = io.osm_graph_from_poly(poly_wgs, simplify=False)\n# decompose for higher resolution analysis\nG_decomp_minimal = graphs.nx_decompose(G_utm_minimal, 25)\n# prepare data structures\n(\n    nodes_gdf_minimal,\n    _edges_gdf_minimal,\n    network_structure_minimal,\n) = io.network_structure_from_nx(G_decomp_minimal, crs=32629)\n# compute centrality\nnodes_gdf_minimal = networks.node_centrality_shortest(\n    network_structure=network_structure_minimal,\n    nodes_gdf=nodes_gdf_minimal,\n    distances=distances,\n)\n\nINFO:cityseer.tools.io:Converting networkX graph from EPSG code 4326 to EPSG code 32630.\nINFO:cityseer.tools.io:Processing node x, y coordinates.\n100%|██████████| 162040/162040 [00:00&lt;00:00, 457123.94it/s]\nINFO:cityseer.tools.io:Processing edge geom coordinates, if present.\n100%|██████████| 178697/178697 [00:00&lt;00:00, 864159.28it/s]\nINFO:cityseer.tools.graphs:Generating interpolated edge geometries.\n100%|██████████| 178697/178697 [00:03&lt;00:00, 57340.84it/s]\nINFO:cityseer.tools.graphs:Removing filler nodes.\n100%|██████████| 162040/162040 [00:20&lt;00:00, 7799.77it/s]\nINFO:cityseer.tools.graphs:Decomposing graph to maximum edge lengths of 25.\n100%|██████████| 70562/70562 [00:24&lt;00:00, 2845.60it/s]\nINFO:cityseer.tools.io:Preparing node and edge arrays from networkX graph.\n100%|██████████| 124895/124895 [00:01&lt;00:00, 73425.58it/s]\n100%|██████████| 124895/124895 [00:19&lt;00:00, 6558.34it/s]\nINFO:cityseer.metrics.networks:Computing shortest path node centrality.\n100%|██████████| 124895/124895 [07:21&lt;00:00, 282.76it/s]\n\n\n\n\nDissolving network weights\nThis approach doesn’t attempt to consolidate the network. Instead, it uses techniques to control for messy network representations:\n\nIt “dissolves” network weights - meaning that nodes representing street segments which are likely duplicitous are weighted less heavily.\nIt injects “jitter” to derive more intuitively consistent network routes.\n\n\n# generate dissolved weights\nG_dissolved_wts = graphs.nx_weight_by_dissolved_edges(G_decomp_minimal, max_ang_diff=25)\n# prepare data structures\n(\n    nodes_gdf_dissolved,\n    _edges_gdf_dissolved,\n    network_structure_dissolved,\n) = io.network_structure_from_nx(G_dissolved_wts, crs=32629)\n# compute centralities\nnodes_gdf_dissolved = networks.node_centrality_shortest(\n    network_structure=network_structure_dissolved,\n    nodes_gdf=nodes_gdf_dissolved,\n    distances=distances,\n    jitter_scale=10,\n)\n\nINFO:cityseer.tools.graphs:Generating node weights based on locally dissolved edges using a buffer of 20m.\nINFO:cityseer.tools.util:Creating edges STR tree.\n100%|██████████| 141552/141552 [00:00&lt;00:00, 685747.69it/s]\n100%|██████████| 141552/141552 [03:02&lt;00:00, 773.93it/s] \n100%|██████████| 124895/124895 [00:04&lt;00:00, 27325.22it/s]\nINFO:cityseer.tools.io:Preparing node and edge arrays from networkX graph.\n100%|██████████| 124895/124895 [00:01&lt;00:00, 98744.11it/s] \n100%|██████████| 124895/124895 [00:21&lt;00:00, 5874.57it/s]\nINFO:cityseer.metrics.networks:Computing shortest path node centrality.\n100%|██████████| 124895/124895 [05:28&lt;00:00, 380.78it/s]\n\n\n\n\nPlots\nCompares a selection of distance thresholds for each approach.\n\nbg_colour = \"#111\"\nbetas = rustalgos.betas_from_distances(distances)\navg_dists = rustalgos.avg_distances_for_betas(betas)\nplot_bbox = poly_utm.centroid.buffer(1500).bounds\nbg_colour = \"#111\"\ntext_colour = \"#ddd\"\nfont_size = 5\nfor d, b, avg_d in zip(distances, betas, avg_dists):\n    fig, axes = plt.subplots(1, 3, figsize=(8, 3), dpi=200, facecolor=bg_colour)\n    fig.suptitle(\n        f\"Gravity index (weighted closeness-like) at avg. walking tolerance:{avg_d:.2f}m and max tolerance of {d}m\",\n        color=text_colour,\n        fontsize=8,\n    )\n    plot.plot_scatter(\n        axes[0],\n        network_structure.node_xs,\n        network_structure.node_ys,\n        nodes_gdf[f\"cc_beta_{d}\"],\n        bbox_extents=plot_bbox,\n        cmap_key=\"magma\",\n        face_colour=bg_colour,\n    )\n    axes[0].set_title(\n        \"Algorithmically cleaned network\", fontsize=font_size, color=text_colour\n    )\n    plot.plot_scatter(\n        axes[1],\n        network_structure_minimal.node_xs,\n        network_structure_minimal.node_ys,\n        nodes_gdf_minimal[f\"cc_beta_{d}\"],\n        bbox_extents=plot_bbox,\n        cmap_key=\"magma\",\n        face_colour=bg_colour,\n    )\n    axes[1].set_title(\n        \"Minimally cleaned network\", fontsize=font_size, color=text_colour\n    )\n    plot.plot_scatter(\n        axes[2],\n        network_structure_dissolved.node_xs,\n        network_structure_dissolved.node_ys,\n        nodes_gdf_dissolved[f\"cc_beta_{d}\"],\n        bbox_extents=plot_bbox,\n        cmap_key=\"magma\",\n        face_colour=bg_colour,\n    )\n    axes[2].set_title(\n        \"Minimal w. dissolved edge weightings and jitter\",\n        fontsize=font_size,\n        color=text_colour,\n    )\n    plt.show()\n\nfor d, b, avg_d in zip(distances, betas, avg_dists):\n    fig, axes = plt.subplots(1, 3, figsize=(8, 3), dpi=200, facecolor=bg_colour)\n    fig.suptitle(\n        f\"Weighted betweenness centrality at avg. walking tolerance:{avg_d:.2f}m and max tolerance of {d}m\",\n        color=text_colour,\n        fontsize=8,\n    )\n    plot.plot_scatter(\n        axes[0],\n        network_structure.node_xs,\n        network_structure.node_ys,\n        nodes_gdf[f\"cc_betweenness_{d}\"],\n        bbox_extents=plot_bbox,\n        cmap_key=\"magma\",\n        s_max=2,\n        face_colour=bg_colour,\n    )\n    axes[0].set_title(\n        \"Algorithmically cleaned network\", fontsize=font_size, color=text_colour\n    )\n    plot.plot_scatter(\n        axes[1],\n        network_structure_minimal.node_xs,\n        network_structure_minimal.node_ys,\n        nodes_gdf_minimal[f\"cc_betweenness_{d}\"],\n        bbox_extents=plot_bbox,\n        cmap_key=\"magma\",\n        s_max=2,\n        face_colour=bg_colour,\n    )\n    axes[1].set_title(\n        \"Minimally cleaned network\", fontsize=font_size, color=text_colour\n    )\n    plot.plot_scatter(\n        axes[2],\n        network_structure_dissolved.node_xs,\n        network_structure_dissolved.node_ys,\n        nodes_gdf_dissolved[f\"cc_betweenness_{d}\"],\n        bbox_extents=plot_bbox,\n        cmap_key=\"magma\",\n        s_max=2,\n        face_colour=bg_colour,\n    )\n    axes[2].set_title(\n        \"Minimal w. dissolved edge weightings and jitter\",\n        fontsize=font_size,\n        color=text_colour,\n    )\n    plt.tight_layout()\n    plt.show()",
    "crumbs": [
      "Preparation",
      "OSM Strategies"
    ]
  }
]